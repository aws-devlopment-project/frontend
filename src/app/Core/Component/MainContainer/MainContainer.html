<div class="content">
  <!-- ì±„ë„ í—¤ë” -->
  <div class="channel-header">
    <div class="channel-info">
      <div>
        <h1 class="channel-title">{{ currentChannel() }}</h1>
        <p class="channel-description">{{ getChannelDescription() }}</p>
      </div>
      <div class="member-count">
        <mat-icon>person</mat-icon>
        <span>{{ memberCount() }}</span>
      </div>
    </div>
    <div class="channel-actions">
      <button class="channel-action-btn" title="ì±„ë„ ì •ë³´" (click)="showChannelInfo()">
        <mat-icon>info</mat-icon>
      </button>
      <button class="channel-action-btn" title="ë©¤ë²„ ë³´ê¸°" (click)="showMembers()">
        <mat-icon>group</mat-icon>
      </button>
      <button class="channel-action-btn" title="ê²€ìƒ‰" (click)="searchInChannel()">
        <mat-icon>search</mat-icon>
      </button>
      <button class="channel-action-btn" title="ë”ë³´ê¸°" (click)="showMoreOptions()">
        <mat-icon>more_vert</mat-icon>
      </button>
    </div>
  </div>

  <!-- ë©”ì‹œì§€ ì˜ì—­ -->
  <div class="messages-container" #messagesContainer>
    @if (messages().length > 0) {
      <div class="messages">
        <!-- ì±„ë„ ì‹œì‘ ë©”ì‹œì§€ -->
        <div class="system-message">
          <strong>#{{ currentChannel() }}</strong> ì±„ë„ì˜ ì‹œì‘ì…ë‹ˆë‹¤
        </div>

        <!-- ë‚ ì§œ êµ¬ë¶„ì„  -->
        <div class="date-divider">
          <span>ì˜¤ëŠ˜</span>
        </div>

        <!-- ë©”ì‹œì§€ ëª©ë¡ -->
        @for (message of messages(); track message.id; let i = $index) {
          <div class="message-item" 
               [class.compact]="isCompactMessage(message, i)"
               (mouseenter)="showMessageActions(message.id)"
               (mouseleave)="hideMessageActions()">
            
            @if (!isCompactMessage(message, i)) {
              <div class="message-avatar">
                {{ getAvatarInitials(message.author) }}
              </div>
            } @else {
              <div class="message-avatar"></div>
            }
            
            <div class="message-content">
              @if (!isCompactMessage(message, i)) {
                <div class="message-header">
                  <span class="message-author">{{ message.author }}</span>
                  <span class="message-timestamp">{{ formatTimestamp(message.timestamp) }}</span>
                </div>
              }
              
              <p class="message-text">{{ message.text }}</p>
              
              <!-- ë©”ì‹œì§€ ì•¡ì…˜ (í˜¸ë²„ ì‹œ í‘œì‹œ) -->
              @if (hoveredMessageId() === message.id) {
                <div class="message-actions">
                  <button class="message-action" title="ì´ëª¨ì§€ ì¶”ê°€" (click)="addReaction(message.id)">
                    ğŸ˜Š
                  </button>
                  <button class="message-action" title="ë‹µê¸€" (click)="replyToMessage(message.id)">
                    ğŸ’¬
                  </button>
                  <button class="message-action" title="ê³µìœ " (click)="shareMessage(message.id)">
                    ğŸ“¤
                  </button>
                  <button class="message-action" title="ë”ë³´ê¸°" (click)="showMessageOptions(message.id)">
                    â‹¯
                  </button>
                </div>
              }
            </div>
          </div>
        }
      </div>
    } @else {
      <!-- ë¹ˆ ìƒíƒœ -->
      <div class="empty-state">
        <mat-icon class="empty-state-icon">chat_bubble_outline</mat-icon>
        <h3>#{{ currentChannel || 'general' }}ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!</h3>
        <p>ì´ ì±„ë„ì˜ ì²« ë²ˆì§¸ ë©”ì‹œì§€ë¥¼ ì‘ì„±í•´ ë³´ì„¸ìš”.</p>
      </div>
    }
  </div>

  <!-- ë©”ì‹œì§€ ì…ë ¥ ì˜ì—­ -->
  <div class="message-input-container">
    <div class="message-input-box">
      <textarea 
        class="message-input"
        placeholder="#{{ currentChannel() }}ì— ë©”ì‹œì§€ ë³´ë‚´ê¸°"
        [value]="newMessage()"
        (input)="onMessageInput($event)"
        (keydown)="handleKeyDown($event)"
        #messageInput
        rows="1"></textarea>
      
      <div class="message-input-actions">
        <div class="input-actions-left">
          <button class="input-action-btn" title="íŒŒì¼ ì²¨ë¶€" (click)="attachFile()">
            <mat-icon>attach_file</mat-icon>
          </button>
          <button class="input-action-btn" title="ì´ëª¨ì§€" (click)="showEmojiPicker()">
            <mat-icon>mood</mat-icon>
          </button>
          <button class="input-action-btn" title="ë©˜ì…˜" (click)="showMentions()">
            <mat-icon>alternate_email</mat-icon>
          </button>
          <button class="input-action-btn" title="ì„œì‹" (click)="showFormatting()">
            <mat-icon>format_bold</mat-icon>
          </button>
        </div>
        
        <button 
          class="send-button" 
          [disabled]="!newMessage().trim()"
          (click)="sendMessage()">
          <mat-icon>send</mat-icon>
          ì „ì†¡
        </button>
      </div>
    </div>
  </div>
</div>