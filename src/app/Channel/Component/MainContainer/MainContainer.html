<!-- UpdatedMainContainer.html - 백엔드 예시에 맞춘 STOMP 기반 템플릿 -->
<div class="chat-container">
  <!-- 채팅 헤더 -->
  <div class="chat-header">
    <div class="channel-info">
      <h3># {{ channelInfo()?.name || currentChannel() || '채널' }}</h3>
      <div class="channel-status">
        <p>{{ channelInfo()?.description || getChannelDescription(currentChannel().name) }}</p>
        <div class="connection-status" [class]="getConnectionStatusClass()">
          <mat-icon class="status-icon">
            {{ connectionStatus() === 'connected' ? 'wifi' : 
               connectionStatus() === 'connecting' ? 'wifi_tethering' : 
               connectionStatus() === 'reconnecting' ? 'sync' : 'wifi_off' }}
          </mat-icon>
          <span>{{ getConnectionStatusText() }}</span>
          @if (connectionStatus() === 'connected' && chatRoomId() !== -1) {
            <span class="room-id">• Club {{ chatRoomId() }}</span>
          }
        </div>
      </div>
    </div>
    <div class="chat-actions">
      <button class="header-btn" title="통계 보기"
              (click)="showStats()">
        <mat-icon>analytics</mat-icon>
        @if (messageStats().count > 0) {
          <span class="message-count-badge">{{ messageStats().count }}</span>
        }
      </button>
      <button class="header-btn" title="연결 테스트"
              (click)="testConnection()">
        <mat-icon>network_check</mat-icon>
      </button>
      <button class="header-btn" title="현재 채널 이력 삭제" 
              [disabled]="messages().length === 0"
              (click)="clearCurrentChannelHistory()">
        <mat-icon>delete_sweep</mat-icon>
      </button>
      @if (connectionStatus() === 'disconnected') {
        <button class="header-btn reconnect-btn" title="다시 연결" (click)="reconnect()">
          <mat-icon>refresh</mat-icon>
        </button>
      }
      <button class="header-btn" title="데모 메시지 추가"
              [disabled]="connectionStatus() !== 'connected'"
              (click)="addDemoMessage()">
        <mat-icon>message</mat-icon>
      </button>
    </div>
  </div>

  <!-- 채팅 메시지 영역 -->
  <div class="chat-messages" #messagesContainer>
    @if (messages().length === 0) {
      <div class="welcome-message">
        <div class="welcome-content">
          <h4>🎉 {{ getWelcomeTitle() }}</h4>
          <p>{{ getWelcomeMessage() }}</p>
          
          @if (connectionStatus() === 'connected') {
            <div class="conversation-starters">
              <h5>대화 시작하기</h5>
              <div class="starter-buttons">
                @for (starter of getConversationStarters(); track starter) {
                  <button class="starter-btn" (click)="sendMessage(starter)">
                    {{ starter }}
                  </button>
                }
              </div>
            </div>
          } @else {
            <div class="connection-waiting">
              <mat-icon class="loading-icon">{{ 
                connectionStatus() === 'connecting' ? 'hourglass_empty' :
                connectionStatus() === 'reconnecting' ? 'sync' : 'error_outline'
              }}</mat-icon>
              <p>{{ getConnectionStatusText() }}</p>
              @if (connectionStatus() === 'disconnected') {
                <button class="reconnect-button" (click)="reconnect()">
                  <mat-icon>refresh</mat-icon>
                  다시 연결
                </button>
              }
            </div>
          }
        </div>
      </div>
    } @else {
      @for (message of messages(); track message.id) {
        <div class="message-group" 
             [class.own-message]="message.isOwn"
             [class.system-message]="message.type === 'system'">
          
          @if (message.type !== 'system') {
            <div class="message-avatar">
              <div class="avatar-placeholder" [class.online]="connectionStatus() === 'connected'">
                {{ message.senderUsername.charAt(0).toUpperCase() }}
                @if (connectionStatus() === 'connected' && !message.isOwn) {
                  <div class="online-indicator"></div>
                }
              </div>
            </div>
            
            <div class="message-content">
              <div class="message-header">
                <span class="username">{{ message.senderUsername }}</span>
                @if (connectionStatus() === 'connected' && !message.isOwn) {
                  <span class="online-badge">온라인</span>
                }
                <span class="timestamp">{{ formatTime(message.timestamp) }}</span>
              </div>
              
              <!-- 일반 채팅 메시지 -->
              @if (message.messageType === 'CHAT') {
                <div class="message-text">{{ message.content }}</div>
              }
              
              <!-- 이미지/파일 메시지 -->
              @if (message.messageType === 'IMAGE') {
                <div class="message-file">
                  @if (getImageData(message)?.type?.startsWith('image/')) {
                    <div class="image-preview" (click)="previewImage(message)">
                      <img [src]="getImageData(message)?.data" 
                           [alt]="getImageData(message)?.name"
                           class="preview-image">
                      <div class="image-info">
                        <span class="file-name">{{ getImageData(message)?.name }}</span>
                        <span class="file-size">({{ formatFileSize(getImageData(message)?.size) }})</span>
                      </div>
                    </div>
                  } @else {
                    <div class="file-preview" (click)="downloadFile(message)">
                      <mat-icon class="file-icon">attach_file</mat-icon>
                      <div class="file-info">
                        <span class="file-name">{{ getImageData(message)?.name }}</span>
                        <span class="file-size">({{ formatFileSize(getImageData(message)?.size) }})</span>
                      </div>
                      <mat-icon class="download-icon">download</mat-icon>
                    </div>
                  }
                </div>
              }
              
              <!-- 입장/퇴장 메시지 -->
              @if (message.messageType === 'JOIN' || message.messageType === 'LEAVE') {
                <div class="message-text system-notice">
                  <mat-icon>{{ message.messageType === 'JOIN' ? 'login' : 'logout' }}</mat-icon>
                  {{ message.content }}
                </div>
              }
            </div>
          } @else {
            <!-- 시스템 메시지 -->
            <div class="system-message-content">
              <mat-icon class="system-icon">info</mat-icon>
              <span class="system-text">{{ message.content }}</span>
              <span class="system-time">{{ formatTime(message.timestamp) }}</span>
            </div>
          }
        </div>
      }
    }
  </div>

  <!-- 메시지 입력 영역 -->
  <div class="chat-input-area">
    <div class="input-container" [class.disabled]="connectionStatus() !== 'connected'">
      <input type="file" #fileInput (change)="onFileSelect($event)" 
             style="display: none;" 
             accept="image/*,video/*,.pdf,.doc,.docx,.txt,.zip">
      
      <button class="input-btn" title="파일 첨부" 
              [disabled]="connectionStatus() !== 'connected'"
              (click)="fileInput.click()">
        <mat-icon>attach_file</mat-icon>
      </button>
      
      <textarea
        class="message-input"
        [(ngModel)]="newMessage"
        [placeholder]="getInputPlaceholder()"
        [disabled]="connectionStatus() !== 'connected'"
        (keydown)="onKeyDown($event)"
        rows="1"
        #messageInput>
      </textarea>
      
      <button class="input-btn" title="이모티콘"
              [disabled]="connectionStatus() !== 'connected'">
        <mat-icon>emoji_emotions</mat-icon>
      </button>
      
      <button 
        class="send-btn" 
        [disabled]="!newMessage().trim() || connectionStatus() !== 'connected'"
        (click)="sendCurrentMessage()"
        title="메시지 전송">
        <mat-icon>send</mat-icon>
      </button>
    </div>
    
    <div class="input-hints">
      @if (connectionStatus() === 'connected') {
        <span><strong>Enter</strong>로 전송, <strong>Shift + Enter</strong>로 줄바꿈</span>
        <span class="storage-info">• 메모리에 최근 50개 메시지 저장 중 (Club ID: {{ chatRoomId() }})</span>
      } @else {
        <span class="connection-hint">{{ getConnectionStatusText() }} - 메시지를 보낼 수 없습니다</span>
      }
    </div>
  </div>
</div>