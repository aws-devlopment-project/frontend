<div class="join-container">
  <!-- 헤더 -->
  <div class="join-header">
    <h1>그룹에 참여해보세요! 🎯</h1>
    <p>관심 있는 그룹을 선택하고 원하는 채널에 참여해서 활동을 시작해보세요</p>
  </div>

  <!-- 단계 표시기 -->
  <div class="step-indicator">
    <div class="step" [class.active]="isStepActive(1)" [class.completed]="isStepCompleted(1)">
      <div class="step-number">1</div>
      <div class="step-text">그룹 선택</div>
    </div>
    <div class="step" [class.active]="isStepActive(2)" [class.completed]="isStepCompleted(2)">
      <div class="step-number">2</div>
      <div class="step-text">채널 선택</div>
    </div>
    <div class="step" [class.active]="isStepActive(3)" [class.completed]="isStepCompleted(3)">
      <div class="step-number">3</div>
      <div class="step-text">참여 완료</div>
    </div>
  </div>

  <!-- 1단계: 그룹 선택 -->
  @if (isStep(1)) {
    <div class="step-content">
      <h2>관심 있는 그룹을 선택하세요</h2>
      
      <div class="groups-grid">
        @for (group of availableGroups(); track group.name) {
          <div class="group-card" 
               [class.selected]="selectedGroup()?.name === group.name"
               (click)="selectGroup(group)">
            
            <div class="group-header">
              <div class="group-emoji">{{ group.emoji }}</div>
              <div class="group-info">
                <h3>{{ group.name }}</h3>
                <div class="group-stats">
                  <span>👥 {{ group.memberCount }}명</span>
                  <span>🔥 오늘 {{ group.activeToday }}명 활동</span>
                </div>
              </div>
            </div>
            
            <p class="group-description">{{ group.description }}</p>
            
            <div class="group-tags">
              @for (tag of group.tags; track tag) {
                <span class="tag">#{{ tag }}</span>
              }
            </div>
            
            <div class="group-metrics">
              <span class="metric">📈 달성률 {{ group.achievementRate }}%</span>
              <span class="metric">⭐ 평점 {{ group.rating }}</span>
            </div>
          </div>
        }
      </div>

      <div class="action-buttons">
        <button class="btn btn-primary" 
                [disabled]="!selectedGroup()"
                (click)="goToChannelSelection()">
          <mat-icon>arrow_forward</mat-icon>
          다음: 채널 선택하기
        </button>
      </div>
    </div>
  }

  <!-- 2단계: 채널 선택 -->
  @if (isStep(2)) {
    <div class="step-content">
      @if (selectedGroup(); as group) {
        <div class="selected-group-info">
          <div class="selected-group-header">
            <span class="selected-group-emoji">{{ group.emoji }}</span>
            <div>
              <h3>{{ group.name }}</h3>
              <p>{{ group.description }}</p>
            </div>
          </div>
        </div>
      }

      <h2>참여할 채널을 선택하세요</h2>
      <p class="step-subtitle">여러 채널을 선택할 수 있습니다</p>

      <div class="channels-grid">
        @for (channel of availableChannels(); track channel.id) {
          <div class="channel-card"
               [class.selected]="isChannelSelected(channel.id)"
               (click)="toggleChannel(channel.id)">
            
            <div class="channel-header">
              <div class="channel-icon">{{ channel.icon }}</div>
              <div class="channel-info">
                <h4>{{ channel.name }}</h4>
                <div class="channel-activity">{{ channel.activity }}</div>
              </div>
            </div>
            
            <p class="channel-description">{{ channel.description }}</p>
            
            <div class="channel-members">
              👥 {{ channel.members }}명 참여 중
            </div>
          </div>
        }
      </div>

      <div class="action-buttons">
        <button class="btn btn-secondary" (click)="goBackToGroups()">
          <mat-icon>arrow_back</mat-icon>
          그룹 다시 선택
        </button>
        <button class="btn btn-primary" 
                [disabled]="!hasSelectedChannels() || isLoading()"
                (click)="joinSelectedGroup()">
          @if (isLoading()) {
            <div class="btn-spinner"></div>
            참여 중...
          } @else {
            <mat-icon>check</mat-icon>
            그룹 참여하기
          }
        </button>
      </div>
    </div>
  }

  <!-- 3단계: 완료 -->
  @if (isStep(3)) {
    <div class="step-content completion-step">
      <div class="completion-icon">🎉</div>
      <h2>참여 완료!</h2>
      
      @if (selectedGroup(); as group) {
        <p class="completion-message">
          <strong>{{ group.name }}</strong>에 성공적으로 참여했습니다.<br>
          이제 선택한 채널에서 활동을 시작해보세요!
        </p>
        
        <div class="selected-channels-summary">
          <h4>참여한 채널</h4>
          <div class="channel-tags">
            @for (channelName of getSelectedChannelNames(); track channelName) {
              <span class="channel-tag">{{ channelName }}</span>
            }
          </div>
        </div>
      }

      <div class="action-buttons">
        <button class="btn btn-primary btn-large" (click)="goToDashboard()">
          <mat-icon>dashboard</mat-icon>
          대시보드로 이동
        </button>
      </div>
    </div>
  }
</div>