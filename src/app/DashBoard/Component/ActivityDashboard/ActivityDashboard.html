<div class="activity-dashboard">
  <!-- ë¡œë”© ìƒíƒœ -->
  @if (isLoading()) {
    <div class="loading-container">
      <div class="loading-spinner">
        <div class="spinner"></div>
        <p>í™œë™ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
      </div>
    </div>
  }
  
  <!-- ëŒ€ì‹œë³´ë“œ ë‚´ìš© -->
  @else {
    <!-- í—¤ë” -->
    <div class="dashboard-header">
      <div class="header-content">
        <h1>ë‚˜ì˜ í™œë™ í˜„í™©</h1>
        <p class="page-description">ê°œì¸ í™œë™ ê¸°ë¡ê³¼ ì„±ì¥ íŒ¨í„´ì„ í™•ì¸í•´ë³´ì„¸ìš”</p>
      </div>
      <div class="header-actions">
        <button class="refresh-btn" (click)="refreshData()">
          <mat-icon>refresh</mat-icon>
        </button>
      </div>
    </div>

    <!-- ì£¼ìš” í†µê³„ ì¹´ë“œ -->
    <div class="stats-section">
      <div class="stats-grid">
        @for (stat of weeklyStats(); track stat.label) {
          <div class="stat-card" [class.trending]="stat.trend === 'up'" [style.--stat-color]="stat.color">
            <div class="stat-icon" [style.background]="'linear-gradient(135deg, ' + stat.color + ', ' + stat.color + '99)'">
              <mat-icon>{{ stat.icon }}</mat-icon>
            </div>
            <div class="stat-content">
              <div class="stat-value">
                {{ stat.value }}{{ stat.unit }}
                @if (stat.trend) {
                  <span class="stat-trend" [class]="stat.trend">
                    @if (stat.trend === 'up') { â†— }
                    @else if (stat.trend === 'down') { â†˜ }
                    @else { â†’ }
                  </span>
                }
              </div>
              <div class="stat-label">{{ stat.label }}</div>
            </div>
          </div>
        }
      </div>
    </div>

    <!-- ìŠ¤ë§ˆíŠ¸ ì¸ì‚¬ì´íŠ¸ ì„¹ì…˜ -->
    @if (smartInsights().length > 0) {
      <div class="insights-section">
        <div class="section-card">
          <div class="section-header">
            <h2>ğŸ’¡ ê°œì¸í™”ëœ ì¸ì‚¬ì´íŠ¸</h2>
            <div class="insight-summary">
              @if (hasHighPriorityInsights()) {
                <span style="color: #3182ce; font-weight: 600;">ğŸ”¥ ì£¼ëª©í•  ì„±ê³¼ê°€ ìˆì–´ìš”!</span>
              }
            </div>
          </div>
          
          <div class="insights-grid">
            @for (insight of smartInsights(); track insight.message; let i = $index) {
              @if (i < 3) {
                <div class="insight-card" [class.high-priority]="insight.priority === 'high'">
                  <div class="insight-icon">{{ getInsightIcon(insight) }}</div>
                  <div class="insight-content">
                    <p class="insight-message">{{ insight.message }}</p>
                    @if (insight.suggestion) {
                      <p class="insight-suggestion">{{ insight.suggestion }}</p>
                    }
                  </div>
                  <div class="priority-indicator" [class]="insight.priority"></div>
                </div>
              }
            }
          </div>
        </div>
      </div>
    }

    <!-- ì£¼ê°„ í€˜ìŠ¤íŠ¸ í˜„í™© -->
    @if (activityData(); as data) {
      <div class="section-card">
        <div class="section-header">
          <h2>ğŸ“Š ì´ë²ˆ ì£¼ í€˜ìŠ¤íŠ¸ í˜„í™©</h2>
          <div class="completion-rate">
            <span class="rate-number">{{ getCompletionRate() }}%</span>
            <span class="rate-label">ì™„ë£Œìœ¨</span>
          </div>
        </div>
        
        <div class="daily-quest-chart">
          @for (day of data.dailyQuests; track day.date) {
            <div class="day-column">
              <div class="day-label">{{ day.date }}</div>
              <div class="day-bars">
                <div class="quest-bar-container">
                  <div class="quest-bar completed" 
                       [style.height.%]="day.target > 0 ? (day.completed / day.target) * 100 : 0">
                  </div>
                  <div class="quest-bar total"></div>
                </div>
                <div class="day-numbers">
                  <span class="completed">{{ day.completed }}</span>
                  <span class="separator">/</span>
                  <span class="total">{{ day.target }}</span>
                </div>
              </div>
            </div>
          }
        </div>
      </div>

      <!-- í™œë™ íŒ¨í„´ ë¶„ì„ -->
      <div class="section-card">
        <div class="section-header">
          <h2>ğŸ“ˆ ì¼ë³„ í™œë™ íŒ¨í„´ ë¶„ì„</h2>
          @if (data.personalizedStats?.groupStats) {
            <div class="pattern-insights">
              <span class="insight-item">
                <strong>ì°¸ì—¬ ê·¸ë£¹:</strong> {{ data.personalizedStats.groupStats.totalGroups }}ê°œ
              </span>
              <span class="insight-item">
                <strong>í™œë°œí•œ ê·¸ë£¹:</strong> {{ data.personalizedStats.groupStats.mostActiveGroup }}
              </span>
            </div>
          }
        </div>
        
        <div class="weekly-pattern">
          @for (dayData of data.weeklyPattern; track dayData.day) {
            <div class="pattern-day">
              <div class="pattern-day-label">{{ dayData.day }}</div>
              <div class="pattern-bar">
                <div class="pattern-fill" 
                     [style.width.%]="getPatternBarWidth(dayData.totalActivities, data.weeklyPattern)"
                     [style.background-color]="getPatternBarColor(dayData.totalActivities, data.weeklyPattern)"
                     [title]="getActivityLevel(dayData.totalActivities, data.weeklyPattern)">
                </div>
              </div>
              <div class="pattern-count">{{ dayData.totalActivities }}</div>
              <div class="pattern-level">{{ getActivityLevel(dayData.totalActivities, data.weeklyPattern) }}</div>
            </div>
          }
        </div>

        <!-- í™œë™ íŒ¨í„´ ë²”ë¡€ ë° í†µê³„ -->
        <div class="pattern-legend">
          <div class="legend-item">
            <div class="legend-color" style="background-color: #3182ce;"></div>
            <span>ë§¤ìš° í™œë°œ</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background-color: #4299e1;"></div>
            <span>í™œë°œ</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background-color: #63b3ed;"></div>
            <span>ë³´í†µ</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background-color: #90cdf4;"></div>
            <span>ë‚®ìŒ</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background-color: #e2e8f0;"></div>
            <span>íœ´ì‹</span>
          </div>
        </div>

        <div class="pattern-stats">
          <div class="pattern-stat">
            <span class="pattern-stat-value">{{ getWeeklyTotal(data.weeklyPattern) }}</span>
            <span class="pattern-stat-label">ì£¼ê°„ ì´í•©</span>
          </div>
          <div class="pattern-stat">
            <span class="pattern-stat-value">{{ getWeeklyAverage(data.weeklyPattern) }}</span>
            <span class="pattern-stat-label">ì¼í‰ê· </span>
          </div>
          <div class="pattern-stat">
            <span class="pattern-stat-value">{{ getMostActiveDay(data.weeklyPattern) }}</span>
            <span class="pattern-stat-label">ìµœê³  í™œë™ì¼</span>
          </div>
          <div class="pattern-stat">
            <span class="pattern-stat-value">{{ getActiveDays(data.weeklyPattern) }}</span>
            <span class="pattern-stat-label">í™œë™ì¼ìˆ˜</span>
          </div>
        </div>
      </div>
    }

    <!-- ìµœê·¼ í™œë™ íƒ€ì„ë¼ì¸ - ìš°ì„ ìˆœìœ„ ê¸°ë°˜ -->
    <div class="section-card">
      <div class="section-header">
        <h2>ğŸ¯ ì£¼ìš” ìµœê·¼ í™œë™</h2>
        <div class="activity-summary">
          ì¤‘ìš”í•œ í™œë™ {{ recentActivities().length }}ê°œ
        </div>
      </div>
      
      <div class="activity-timeline">
        @for (activity of recentActivities(); track activity.id; let i = $index) {
          @if (i < 6) {
            <div class="timeline-item">
              <div class="timeline-marker">
                <div class="activity-icon">{{ activity.icon }}</div>
              </div>
              <div class="timeline-content">
                <div class="priority-indicator" [class]="activity.priority"></div>
                <div class="activity-header">
                  <h4 class="activity-title">{{ activity.title }}</h4>
                  <div class="activity-meta">
                    <span class="activity-badge" 
                          [style.background]="getActivityTypeColor(activity.type)">
                      {{ getActivityTypeBadge(activity.type) }}
                    </span>
                    @if (activity.points) {
                      <span class="activity-points">+{{ activity.points }}pt</span>
                    }
                    <span class="activity-time">{{ getTimeAgo(activity.timestamp) }}</span>
                  </div>
                </div>
                <p class="activity-description">{{ activity.description }}</p>
              </div>
            </div>
          }
        }
      </div>

      <!-- ì „ì²´ í™œë™ ë³´ê¸° ë²„íŠ¼ -->
      @if (recentActivities().length === 0) {
        <div class="timeline-footer">
          <div style="text-align: center; padding: 40px; color: #718096;">
            <mat-icon style="font-size: 48px; color: #cbd5e0; margin-bottom: 16px;">insights</mat-icon>
            <h3 style="color: #4a5568; margin: 16px 0 8px 0;">í™œë™ì„ ì‹œì‘í•´ë³´ì„¸ìš”!</h3>
            <p style="margin: 0;">ì²« ë²ˆì§¸ í€˜ìŠ¤íŠ¸ë¥¼ ì™„ë£Œí•˜ê±°ë‚˜ ê·¸ë£¹ì— ì°¸ì—¬í•´ë³´ì„¸ìš”.</p>
          </div>
        </div>
      }
      
      @if (recentActivities().length > 6) {
        <div class="timeline-footer">
          <button class="btn btn-secondary">
            <mat-icon>visibility</mat-icon>
            ì „ì²´ í™œë™ ë³´ê¸°
          </button>
        </div>
      }
    </div>
  }
</div>