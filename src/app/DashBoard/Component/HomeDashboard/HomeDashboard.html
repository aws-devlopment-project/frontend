<div class="home-container">
  @if (isLoading()) {
    <div class="loading-container">
      <div class="loading-spinner">
        <div class="spinner"></div>
        <p>대시보드 데이터를 불러오는 중...</p>
      </div>
    </div>
  } @else {
    <!-- 환영 섹션 -->
    <div class="welcome-section">
      <div class="welcome-content">
        <h1 class="welcome-title">
          {{ getGreeting() }} 👋
        </h1>
        <p class="welcome-subtitle">
          {{ getFormattedTime() }}
        </p>
        <p class="welcome-message">
          오늘도 목표를 향해 한 걸음씩 나아가는 멋진 하루 보내세요!
        </p>
      </div>
      <div class="welcome-illustration">
        <div class="illustration-icon">🎯</div>
      </div>
    </div>

    <!-- 빠른 통계 섹션 -->
    <div class="quick-stats-section">
      <div class="section-header">
        <h2 class="section-title">
          <mat-icon>insights</mat-icon>
          실시간 현황
        </h2>
        <button class="view-all-btn" (click)="onViewDetailedStats()">
          상세 보기
          <mat-icon>arrow_forward</mat-icon>
        </button>
      </div>
      <div class="stats-grid">
        @for (stat of quickStats(); track stat.id) {
          <div class="stat-card" [style.border-left-color]="stat.color">
            <div class="stat-icon" [style.background-color]="stat.color">
              <mat-icon>{{ stat.icon }}</mat-icon>
            </div>
            <div class="stat-content">
              <div class="stat-value">{{ stat.value }}</div>
              <div class="stat-title">{{ stat.title }}</div>
              <div class="stat-change" [style.color]="stat.color">
                <mat-icon class="change-icon">{{ stat.trend === 'up' ? 'trending_up' : stat.trend === 'down' ? 'trending_down' : 'trending_flat' }}</mat-icon>
                {{ stat.change }}
              </div>
            </div>
          </div>
        }
      </div>
    </div>

    <!-- 퀘스트 캘린더 섹션 -->
    <div class="activity-streak-section">
      <div class="section-header">
        <h2 class="section-title">
          <mat-icon>calendar_month</mat-icon>
          퀘스트 캘린더
        </h2>
        <div class="streak-summary">
          <div class="streak-badge current">
            <span class="streak-number">{{ currentStreak() }}</span>
            <span class="streak-label">연속일</span>
          </div>
          <div class="streak-badge record">
            <span class="streak-number">{{ longestStreak() }}</span>
            <span class="streak-label">최고기록</span>
          </div>
        </div>
      </div>
      
      <div class="calendar-container">
        <app-streak-calendar
          [questData]="questCalendarData()"
          [currentStreak]="currentStreak()"
          [longestStreak]="longestStreak()"
          (questClick)="onQuestClick($event)"
          (dayClick)="onDayClick($event)">
        </app-streak-calendar>
      </div>

      <!-- 주간 목표 진행률 -->
      <div class="weekly-progress">
        <div class="progress-header">
          <h3>이번 주 목표 진행률</h3>
          <span class="progress-percent">{{ getWeeklyProgressPercent() }}%</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" 
               [style.width.%]="getWeeklyProgressPercent()"
               [style.background-color]="getWeeklyProgressPercent() >= 70 ? '#48bb78' : getWeeklyProgressPercent() >= 40 ? '#f6ad55' : '#4299e1'">
          </div>
        </div>
        <div class="progress-details">
          <span>{{ activitySummary().weeklyProgress }}일 / {{ activitySummary().weeklyGoal }}일 목표</span>
        </div>
      </div>

      <!-- 퀘스트 캘린더 사용법 안내 -->
      <div class="calendar-guide">
        <div class="guide-item">
          <mat-icon class="guide-icon">touch_app</mat-icon>
          <span class="guide-text">퀘스트를 클릭하면 해당 그룹으로 이동합니다</span>
        </div>
        <div class="guide-item">
          <mat-icon class="guide-icon">calendar_today</mat-icon>
          <span class="guide-text">날짜를 클릭하면 해당 날의 모든 퀘스트를 볼 수 있습니다</span>
        </div>
        <div class="guide-item">
          <mat-icon class="guide-icon">palette</mat-icon>
          <span class="guide-text">색상은 퀘스트 완료율을 나타냅니다</span>
        </div>
      </div>
    </div>

    <!-- 개인화된 인사이트 -->
    @if (personalInsights().length > 0) {
      <div class="insights-section">
        <h2 class="section-title">
          <mat-icon>psychology</mat-icon>
          개인 맞춤 인사이트
        </h2>
        <div class="insights-list">
          @for (insight of personalInsights(); track insight; let i = $index) {
            <div class="insight-item" [attr.data-index]="i">
              <div class="insight-content">
                <p>{{ insight }}</p>
              </div>
            </div>
          }
        </div>
      </div>
    }

    <!-- 빠른 액션 -->
    <div class="quick-actions-section">
      <h2 class="section-title">
        <mat-icon>flash_on</mat-icon>
        빠른 액션
      </h2>
      <div class="actions-grid">
        @for (action of quickActions(); track action.id) {
          <div class="action-card" (click)="onQuickAction(action)">
            <div class="action-icon" [style.background-color]="action.color">
              <mat-icon>{{ action.icon }}</mat-icon>
            </div>
            <div class="action-content">
              <h3 class="action-title">{{ action.title }}</h3>
              <p class="action-description">{{ action.description }}</p>
            </div>
            <div class="action-arrow">
              <mat-icon>arrow_forward_ios</mat-icon>
            </div>
          </div>
        }
      </div>
    </div>

    <!-- 오늘의 하이라이트 -->
    <div class="highlights-section">
      <div class="section-header">
        <h2 class="section-title">
          <mat-icon>star</mat-icon>
          최근 활동
        </h2>
        <button class="view-all-btn" (click)="onViewAllHighlights()">
          전체 보기
          <mat-icon>arrow_forward</mat-icon>
        </button>
      </div>
      
      <div class="highlights-list">
        @for (highlight of highlights(); track highlight.id) {
          <div class="highlight-item" [attr.data-type]="highlight.type">
            <div class="highlight-icon">
              @if (highlight.avatar) {
                <span class="highlight-avatar">{{ highlight.avatar }}</span>
              } @else {
                <mat-icon>{{ highlight.type === 'achievement' ? 'emoji_events' : highlight.type === 'member' ? 'person' : 'campaign' }}</mat-icon>
              }
            </div>
            <div class="highlight-content">
              <div class="highlight-header">
                <h4 class="highlight-title">{{ highlight.title }}</h4>
                @if (highlight.badge) {
                  <span class="highlight-badge" [class]="highlight.badge.toLowerCase()">
                    {{ highlight.badge }}
                  </span>
                }
              </div>
              <p class="highlight-description">{{ highlight.description }}</p>
              @if (highlight.time) {
                <span class="highlight-time">{{ highlight.time }}</span>
              }
            </div>
          </div>
        }
      </div>
    </div>

    <!-- 추천 퀘스트 -->
    @if (recommendedChallenges().length > 1) {
      <div class="recommendations-section">
        <div class="section-header">
          <h2 class="section-title">
            <mat-icon>recommend</mat-icon>
            추천 퀘스트
          </h2>
        </div>
        
        <div class="recommendations-grid">
          @for (challenge of recommendedChallenges(); track challenge.id) {
            @if (challenge.id !== "0") {
              <div class="recommendation-card">
                <div class="card-header">
                  <div class="challenge-image">{{ challenge.image }}</div>
                  <div class="challenge-meta">
                    <span class="challenge-category">{{ challenge.category }}</span>
                    <span class="challenge-difficulty" [style.color]="getDifficultyColor(challenge.difficulty)">
                      {{ getDifficultyText(challenge.difficulty) }}
                    </span>
                  </div>
                </div>
                
                <div class="card-content">
                  <h3 class="challenge-title">{{ challenge.title }}</h3>
                  <p class="challenge-description">
                    @if (challenge.description) {
                      {{ challenge.description }}
                    } @else {
                      {{ challenge.category }} 그룹의 인기 퀘스트입니다. 지금 참여해보세요!
                    }
                  </p>
                  
                  <div class="challenge-stats">
                    <div class="participants">
                      <mat-icon>group</mat-icon>
                      <span>{{ challenge.participants | number }}명 참여중</span>
                    </div>
                  </div>
                </div>
                
                <div class="card-actions">
                  <button class="join-btn" (click)="onJoinChallenge(challenge)">
                    <mat-icon>arrow_forward_ios</mat-icon>
                    참여하기
                  </button>
                </div>
              </div>
            }
          }
        </div>
      </div>
    }
  }
</div>