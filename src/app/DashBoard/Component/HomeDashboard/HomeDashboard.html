<div class="home-container">
  @if (isLoading()) {
    <div class="loading-container">
      <div class="loading-spinner">
        <div class="spinner"></div>
        <p>ëŒ€ì‹œë³´ë“œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
      </div>
    </div>
  } @else {
    <!-- í™˜ì˜ ì„¹ì…˜ -->
    <div class="welcome-section">
      <div class="welcome-content">
        <h1 class="welcome-title">
          {{ getGreeting() }} ğŸ‘‹
        </h1>
        <p class="welcome-subtitle">
          {{ getFormattedTime() }}
        </p>
        <p class="welcome-message">
          ì˜¤ëŠ˜ë„ ëª©í‘œë¥¼ í–¥í•´ í•œ ê±¸ìŒì”© ë‚˜ì•„ê°€ëŠ” ë©‹ì§„ í•˜ë£¨ ë³´ë‚´ì„¸ìš”!
        </p>
      </div>
      <div class="welcome-illustration">
        <div class="illustration-icon">ğŸ¯</div>
      </div>
    </div>

    <!-- ë¹ ë¥¸ í†µê³„ ì„¹ì…˜ -->
    <div class="quick-stats-section">
      <div class="section-header">
        <h2 class="section-title">
          <mat-icon>insights</mat-icon>
          ì‹¤ì‹œê°„ í˜„í™©
        </h2>
        <button class="view-all-btn" (click)="onViewDetailedStats()">
          ìƒì„¸ ë³´ê¸°
          <mat-icon>arrow_forward</mat-icon>
        </button>
      </div>
      <div class="stats-grid">
        @for (stat of quickStats(); track stat.id) {
          <div class="stat-card" [style.border-left-color]="stat.color">
            <div class="stat-icon" [style.background-color]="stat.color">
              <mat-icon>{{ stat.icon }}</mat-icon>
            </div>
            <div class="stat-content">
              <div class="stat-value">{{ stat.value }}</div>
              <div class="stat-title">{{ stat.title }}</div>
              <div class="stat-change" [style.color]="stat.color">
                <mat-icon class="change-icon">{{ stat.trend === 'up' ? 'trending_up' : stat.trend === 'down' ? 'trending_down' : 'trending_flat' }}</mat-icon>
                {{ stat.change }}
              </div>
            </div>
          </div>
        }
      </div>
    </div>

    <!-- í€˜ìŠ¤íŠ¸ ìº˜ë¦°ë” ì„¹ì…˜ -->
    <div class="activity-streak-section">
      <div class="section-header">
        <h2 class="section-title">
          <mat-icon>calendar_month</mat-icon>
          í€˜ìŠ¤íŠ¸ ìº˜ë¦°ë”
        </h2>
        <div class="streak-summary">
          <div class="streak-badge current">
            <span class="streak-number">{{ currentStreak() }}</span>
            <span class="streak-label">ì—°ì†ì¼</span>
          </div>
          <div class="streak-badge record">
            <span class="streak-number">{{ longestStreak() }}</span>
            <span class="streak-label">ìµœê³ ê¸°ë¡</span>
          </div>
        </div>
      </div>
      
      <div class="calendar-container">
        <app-streak-calendar
          [questData]="questCalendarData()"
          [currentStreak]="currentStreak()"
          [longestStreak]="longestStreak()"
          (questClick)="onQuestClick($event)"
          (dayClick)="onDayClick($event)">
        </app-streak-calendar>
      </div>

      <!-- ì£¼ê°„ ëª©í‘œ ì§„í–‰ë¥  -->
      <div class="weekly-progress">
        <div class="progress-header">
          <h3>ì´ë²ˆ ì£¼ ëª©í‘œ ì§„í–‰ë¥ </h3>
          <span class="progress-percent">{{ getWeeklyProgressPercent() }}%</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" 
               [style.width.%]="getWeeklyProgressPercent()"
               [style.background-color]="getWeeklyProgressPercent() >= 70 ? '#48bb78' : getWeeklyProgressPercent() >= 40 ? '#f6ad55' : '#4299e1'">
          </div>
        </div>
        <div class="progress-details">
          <span>{{ activitySummary().weeklyProgress }}ì¼ / {{ activitySummary().weeklyGoal }}ì¼ ëª©í‘œ</span>
        </div>
      </div>

      <!-- í€˜ìŠ¤íŠ¸ ìº˜ë¦°ë” ì‚¬ìš©ë²• ì•ˆë‚´ -->
      <div class="calendar-guide">
        <div class="guide-item">
          <mat-icon class="guide-icon">touch_app</mat-icon>
          <span class="guide-text">í€˜ìŠ¤íŠ¸ë¥¼ í´ë¦­í•˜ë©´ í•´ë‹¹ ê·¸ë£¹ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤</span>
        </div>
        <div class="guide-item">
          <mat-icon class="guide-icon">calendar_today</mat-icon>
          <span class="guide-text">ë‚ ì§œë¥¼ í´ë¦­í•˜ë©´ í•´ë‹¹ ë‚ ì˜ ëª¨ë“  í€˜ìŠ¤íŠ¸ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤</span>
        </div>
        <div class="guide-item">
          <mat-icon class="guide-icon">palette</mat-icon>
          <span class="guide-text">ìƒ‰ìƒì€ í€˜ìŠ¤íŠ¸ ì™„ë£Œìœ¨ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤</span>
        </div>
      </div>
    </div>

    <!-- ê°œì¸í™”ëœ ì¸ì‚¬ì´íŠ¸ -->
    @if (personalInsights().length > 0) {
      <div class="insights-section">
        <h2 class="section-title">
          <mat-icon>psychology</mat-icon>
          ê°œì¸ ë§ì¶¤ ì¸ì‚¬ì´íŠ¸
        </h2>
        <div class="insights-list">
          @for (insight of personalInsights(); track insight; let i = $index) {
            <div class="insight-item" [attr.data-index]="i">
              <div class="insight-content">
                <p>{{ insight }}</p>
              </div>
            </div>
          }
        </div>
      </div>
    }

    <!-- ë¹ ë¥¸ ì•¡ì…˜ -->
    <div class="quick-actions-section">
      <h2 class="section-title">
        <mat-icon>flash_on</mat-icon>
        ë¹ ë¥¸ ì•¡ì…˜
      </h2>
      <div class="actions-grid">
        @for (action of quickActions(); track action.id) {
          <div class="action-card" (click)="onQuickAction(action)">
            <div class="action-icon" [style.background-color]="action.color">
              <mat-icon>{{ action.icon }}</mat-icon>
            </div>
            <div class="action-content">
              <h3 class="action-title">{{ action.title }}</h3>
              <p class="action-description">{{ action.description }}</p>
            </div>
            <div class="action-arrow">
              <mat-icon>arrow_forward_ios</mat-icon>
            </div>
          </div>
        }
      </div>
    </div>

    <!-- ì˜¤ëŠ˜ì˜ í•˜ì´ë¼ì´íŠ¸ -->
    <div class="highlights-section">
      <div class="section-header">
        <h2 class="section-title">
          <mat-icon>star</mat-icon>
          ìµœê·¼ í™œë™
        </h2>
        <button class="view-all-btn" (click)="onViewAllHighlights()">
          ì „ì²´ ë³´ê¸°
          <mat-icon>arrow_forward</mat-icon>
        </button>
      </div>
      
      <div class="highlights-list">
        @for (highlight of highlights(); track highlight.id) {
          <div class="highlight-item" [attr.data-type]="highlight.type">
            <div class="highlight-icon">
              @if (highlight.avatar) {
                <span class="highlight-avatar">{{ highlight.avatar }}</span>
              } @else {
                <mat-icon>{{ highlight.type === 'achievement' ? 'emoji_events' : highlight.type === 'member' ? 'person' : 'campaign' }}</mat-icon>
              }
            </div>
            <div class="highlight-content">
              <div class="highlight-header">
                <h4 class="highlight-title">{{ highlight.title }}</h4>
                @if (highlight.badge) {
                  <span class="highlight-badge" [class]="highlight.badge.toLowerCase()">
                    {{ highlight.badge }}
                  </span>
                }
              </div>
              <p class="highlight-description">{{ highlight.description }}</p>
              @if (highlight.time) {
                <span class="highlight-time">{{ highlight.time }}</span>
              }
            </div>
          </div>
        }
      </div>
    </div>

    <!-- ì¶”ì²œ í€˜ìŠ¤íŠ¸ -->
    @if (recommendedChallenges().length > 1) {
      <div class="recommendations-section">
        <div class="section-header">
          <h2 class="section-title">
            <mat-icon>recommend</mat-icon>
            ì¶”ì²œ í€˜ìŠ¤íŠ¸
          </h2>
        </div>
        
        <div class="recommendations-grid">
          @for (challenge of recommendedChallenges(); track challenge.id) {
            @if (challenge.id !== "0") {
              <div class="recommendation-card">
                <div class="card-header">
                  <div class="challenge-image">{{ challenge.image }}</div>
                  <div class="challenge-meta">
                    <span class="challenge-category">{{ challenge.category }}</span>
                    <span class="challenge-difficulty" [style.color]="getDifficultyColor(challenge.difficulty)">
                      {{ getDifficultyText(challenge.difficulty) }}
                    </span>
                  </div>
                </div>
                
                <div class="card-content">
                  <h3 class="challenge-title">{{ challenge.title }}</h3>
                  <p class="challenge-description">
                    @if (challenge.description) {
                      {{ challenge.description }}
                    } @else {
                      {{ challenge.category }} ê·¸ë£¹ì˜ ì¸ê¸° í€˜ìŠ¤íŠ¸ì…ë‹ˆë‹¤. ì§€ê¸ˆ ì°¸ì—¬í•´ë³´ì„¸ìš”!
                    }
                  </p>
                  
                  <div class="challenge-stats">
                    <div class="participants">
                      <mat-icon>group</mat-icon>
                      <span>{{ challenge.participants | number }}ëª… ì°¸ì—¬ì¤‘</span>
                    </div>
                  </div>
                </div>
                
                <div class="card-actions">
                  <button class="join-btn" (click)="onJoinChallenge(challenge)">
                    <mat-icon>arrow_forward_ios</mat-icon>
                    ì°¸ì—¬í•˜ê¸°
                  </button>
                </div>
              </div>
            }
          }
        </div>
      </div>
    }
  }
</div>