<div class="dashboard-container">
  <!-- í”¼ë“œë°± ëª¨ë‹¬ -->
  @if (showFeedback()) {
    <div class="modal-overlay">
      <div class="feedback-modal">
        <div class="modal-header">
          <div class="modal-icon">ğŸ‰</div>
          <h3>í€˜ìŠ¤íŠ¸ ì™„ë£Œ!</h3>
          <button class="close-btn" (click)="closeFeedback()">
            <mat-icon>close</mat-icon>
          </button>
        </div>
        
        <div class="modal-content">
          <h4>{{ feedbackData()?.questTitle }}</h4>
          <p>ì¶•í•˜í•©ë‹ˆë‹¤! í€˜ìŠ¤íŠ¸ë¥¼ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œí•˜ì…¨ìŠµë‹ˆë‹¤.</p>
          <p class="feedback-question">ì´ í€˜ìŠ¤íŠ¸ëŠ” ì–´ë– ì…¨ë‚˜ìš”?</p>
          
          <!-- ì¢‹ì•„ìš”/ì‹«ì–´ìš” ë²„íŠ¼ -->
          <div class="like-section">
            <div class="like-buttons">
              <button 
                class="like-btn"
                [class.selected]="feedbackLike() === true"
                (click)="setFeedbackLike(true)"
                [disabled]="isSubmittingFeedback()">
                <mat-icon>thumb_up</mat-icon>
                <span>ì¢‹ì•˜ì–´ìš”</span>
              </button>
              <button 
                class="dislike-btn"
                [class.selected]="feedbackLike() === false"
                (click)="setFeedbackLike(false)"
                [disabled]="isSubmittingFeedback()">
                <mat-icon>thumb_down</mat-icon>
                <span>ì•„ì‰¬ì›Œìš”</span>
              </button>
            </div>
            
            @if (feedbackLike() !== null) {
              <div class="selection-feedback">
                {{ feedbackLike() ? 'ğŸ‘ ì¢‹ì€ ê²½í—˜ì´ì…¨êµ°ìš”!' : 'ğŸ‘ ê°œì„ í•  ì ì„ ì•Œë ¤ì£¼ì„¸ìš”!' }}
              </div>
            }
          </div>
          
          <!-- í…ìŠ¤íŠ¸ ì…ë ¥ -->
          <div class="feedback-input">
            <mat-form-field appearance="outline">
              <mat-label>ì†Œê°ì„ ì•Œë ¤ì£¼ì„¸ìš”</mat-label>
              <textarea 
                matInput 
                rows="3"
                maxlength="200"
                [placeholder]="feedbackLike() === true ? 
                  'ì–´ë–¤ ì ì´ ì¢‹ì•˜ëŠ”ì§€ ì•Œë ¤ì£¼ì„¸ìš”...' :
                  'ì–´ë–¤ ì ì´ ì•„ì‰¬ì› ëŠ”ì§€ ì•Œë ¤ì£¼ì„¸ìš”...'"
                [value]="feedbackText()"
                (input)="onFeedbackTextChange($event)"
                [disabled]="isSubmittingFeedback()">
              </textarea>
              <mat-hint>{{ feedbackTextLength() }}/200ì</mat-hint>
              @if (!isFeedbackValid() && feedbackTextLength() > 0) {
                <mat-error>ìµœì†Œ 5ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”</mat-error>
              }
            </mat-form-field>
          </div>
          
          <div class="modal-actions">
            <button 
              class="btn secondary" 
              (click)="closeFeedback()"
              [disabled]="isSubmittingFeedback()">
              ê±´ë„ˆë›°ê¸°
            </button>
            <button 
              class="btn primary" 
              [disabled]="!isFeedbackValid() || isSubmittingFeedback()"
              (click)="submitFeedback()">
              @if (isSubmittingFeedback()) {
                <div class="spinner"></div>
                ì „ì†¡ ì¤‘...
              } @else {
                <mat-icon>send</mat-icon>
                í”¼ë“œë°± ì „ì†¡
              }
            </button>
          </div>
        </div>
      </div>
    </div>
  }

  <!-- í™•ì¸ ëª¨ë‹¬ -->
  @if (showConfirmModal()) {
    <div class="modal-overlay">
      <div class="confirm-modal">
        <div class="modal-header">
          <div class="modal-icon">âœ…</div>
          <h3>í€˜ìŠ¤íŠ¸ ì™„ë£Œ í™•ì¸</h3>
        </div>
        
        <div class="modal-content">
          <p>ë‹¤ìŒ í€˜ìŠ¤íŠ¸ë“¤ì„ ì™„ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
          
          <div class="quest-list">
            @for (questName of confirmModalData()?.questNames || []; track questName) {
              <div class="quest-item">
                <mat-icon>assignment_turned_in</mat-icon>
                <span>{{ questName }}</span>
              </div>
            }
          </div>
        </div>
        
        <div class="modal-actions">
          <button class="btn secondary" (click)="cancelQuestCompletion()">
            ì·¨ì†Œ
          </button>
          <button class="btn primary" (click)="confirmQuestCompletion()">
            ì™„ë£Œ ì²˜ë¦¬
          </button>
        </div>
      </div>
    </div>
  }

  <!-- ë¡œë”© ìƒíƒœ -->
  @if (isLoading()) {
    <div class="loading-container">
      <div class="spinner"></div>
      <p>ê·¸ë£¹ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
    </div>
  }
  
  <!-- ì—ëŸ¬ ìƒíƒœ -->
  @else if (error() !== null) {
    <div class="error-container">
      <div class="error-icon">âš ï¸</div>
      <h3>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h3>
      <p>{{ error() }}</p>
      <button class="btn primary" (click)="retry()">
        <mat-icon>refresh</mat-icon>
        ë‹¤ì‹œ ì‹œë„
      </button>
    </div>
  }
  
  <!-- ë©”ì¸ ëŒ€ì‹œë³´ë“œ -->
  @else {
    <!-- í—¤ë” -->
    <div class="dashboard-header">
      <div class="header-content">
        <h1>{{ title() }}</h1>
        <p>ì˜¤ëŠ˜ë„ ëª©í‘œë¥¼ í–¥í•´ í•œ ê±¸ìŒ ë” ë‚˜ì•„ê°€ìš”! ğŸ’ª</p>
      </div>
      <div class="achievement-badge">
        <span class="achievement-number">{{ achievementRate() }}%</span>
        <span class="achievement-label">ê°œì¸ ë‹¬ì„±ë¥ </span>
      </div>
    </div>

    <!-- í†µê³„ ì¹´ë“œ -->
    <div class="stats-section">
      <div class="stats-grid">
        @for (stat of stats(); track stat.id) {
          <div class="stat-card">
            <div class="stat-icon">
              <mat-icon>{{ stat.icon }}</mat-icon>
            </div>
            <div class="stat-content">
              <div class="stat-number">{{ stat.value }}{{ stat.unit }}</div>
              <div class="stat-label">{{ stat.label }}</div>
            </div>
          </div>
        }
      </div>
    </div>

    <!-- í€˜ìŠ¤íŠ¸ ì„¹ì…˜ -->
    <div class="quests-section">
      <div class="section-header">
        <h2>
          <mat-icon>assignment</mat-icon>
          ì¼ì¼ í€˜ìŠ¤íŠ¸
        </h2>
        <p>í´ë¦­í•˜ì—¬ í€˜ìŠ¤íŠ¸ë¥¼ ì„ íƒí•˜ê³  ì™„ë£Œí•´ë³´ì„¸ìš”</p>
      </div>
      
      @if (quests().length > 0) {
        <div class="quest-grid">
          @for (quest of quests(); track quest.id) {
            <div 
              class="{{ getQuestCardClass(quest) }}"
              (click)="onQuestClick(quest)">
              
              <!-- í€˜ìŠ¤íŠ¸ í—¤ë” -->
              <div class="quest-header">
                <div class="quest-icon">{{ quest.icon }}</div>
                <div class="quest-info">
                  <h3>{{ quest.title }}</h3>
                  <p>{{ quest.description }}</p>
                </div>
                <div class="quest-status">
                  <mat-icon [style.color]="getPersonalStatusColor(quest)">
                    {{ getPersonalStatusIcon(quest) }}
                  </mat-icon>
                </div>
              </div>
              
              <!-- ì§„í–‰ë¥  ë°” -->
              <div class="progress-section">
                <div class="progress-header">
                  <span class="progress-label">ê·¸ë£¹ ì§„í–‰ë¥ </span>
                  <span class="progress-text">{{ getGroupProgressText(quest) }}</span>
                </div>
                <div class="progress-bar">
                  <div 
                    class="progress-fill" 
                    [style.width.%]="quest.progress"
                    [style.background-color]="getStatusColor(quest.status)">
                  </div>
                </div>
                <div class="progress-percentage">{{ quest.progress }}%</div>
              </div>

              <!-- ì„ íƒ í‘œì‹œ -->
              @if (isQuestSelected(quest.id)) {
                <div class="selection-indicator">
                  <mat-icon>check_circle</mat-icon>
                </div>
              }

              <!-- ì™„ë£Œ í‘œì‹œ -->
              @if (isPersonallyCompleted(quest)) {
                <div class="completion-badge">
                  <mat-icon>verified</mat-icon>
                  <span>ì™„ë£Œë¨</span>
                </div>
              }
            </div>
          }
        </div>

        <!-- ì•¡ì…˜ ë²„íŠ¼ -->
        <div class="action-section">
          <button 
            class="btn primary large"
            [disabled]="!hasSelectedQuests()"
            (click)="onQuestAction()">
            <mat-icon>check</mat-icon>
            ì„ íƒí•œ í€˜ìŠ¤íŠ¸ ì™„ë£Œí•˜ê¸° ({{ selectedQuestIds().size }})
          </button>
        </div>
      } @else {
        <div class="empty-state">
          <div class="empty-icon">ğŸ“</div>
          <h3>ì•„ì§ í€˜ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
          <p>ê³§ ìƒˆë¡œìš´ í€˜ìŠ¤íŠ¸ê°€ ì¶”ê°€ë  ì˜ˆì •ì…ë‹ˆë‹¤!</p>
        </div>
      }
    </div>
  }
</div>