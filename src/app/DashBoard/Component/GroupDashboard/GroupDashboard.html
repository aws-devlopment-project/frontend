<div class="content">
  <!-- í”Œë¡œíŒ… í”¼ë“œë°± UI -->
  @if (showFeedback()) {
    <div class="floating-feedback-overlay">
      <div class="floating-feedback-card">
        <div class="feedback-header">
          <div class="feedback-icon">ğŸ‰</div>
          <div class="feedback-title">í€˜ìŠ¤íŠ¸ ì™„ë£Œ!</div>
          <button class="feedback-close" (click)="closeFeedback()">
            <mat-icon>close</mat-icon>
          </button>
        </div>
        
        <div class="feedback-content">
          <h3>{{ feedbackData()?.questTitle }}</h3>
          <p>ì¶•í•˜í•©ë‹ˆë‹¤! í€˜ìŠ¤íŠ¸ë¥¼ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œí•˜ì…¨ìŠµë‹ˆë‹¤.</p>
          <p class="feedback-question">ì´ í€˜ìŠ¤íŠ¸ëŠ” ì–´ë– ì…¨ë‚˜ìš”?</p>
          
          <div class="rating-section">
            <div class="rating-stars">
              @for (star of [1,2,3,4,5]; track star) {
                <button 
                  class="star-button"
                  [class.active]="feedbackScore() >= star"
                  [class.selected]="feedbackScore() === star"
                  (click)="setFeedbackScore(star)"
                  [disabled]="isSubmittingFeedback()">
                  <mat-icon>{{ feedbackScore() >= star ? 'star' : 'star_border' }}</mat-icon>
                </button>
              }
            </div>
            <div class="rating-labels">
              <span class="rating-label-left">ë³„ë¡œì˜ˆìš”</span>
              <span class="rating-label-right">ìµœê³ ì˜ˆìš”</span>
            </div>
          </div>
          
          <div class="feedback-actions">
            <button 
              class="btn btn-secondary feedback-btn" 
              (click)="closeFeedback()"
              [disabled]="isSubmittingFeedback()">
              ê±´ë„ˆë›°ê¸°
            </button>
            <button 
              class="btn btn-primary feedback-btn" 
              [disabled]="feedbackScore() === 0 || isSubmittingFeedback()"
              (click)="submitFeedback()">
              @if (isSubmittingFeedback()) {
                <div class="btn-spinner"></div>
                ì „ì†¡ ì¤‘...
              } @else {
                <mat-icon>send</mat-icon>
                í”¼ë“œë°± ì „ì†¡
              }
            </button>
          </div>
        </div>
      </div>
    </div>
  }

  <!-- í€˜ìŠ¤íŠ¸ ì™„ë£Œ í™•ì¸ ëª¨ë‹¬ -->
  @if (showConfirmModal()) {
    <div class="confirm-modal-overlay">
      <div class="confirm-modal-card">
        <div class="modal-header">
          <div class="modal-icon">âœ…</div>
          <h3>í€˜ìŠ¤íŠ¸ ì™„ë£Œ í™•ì¸</h3>
        </div>
        
        <div class="modal-content">
          <p>ë‹¤ìŒ í€˜ìŠ¤íŠ¸ë“¤ì„ ì™„ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
          
          <div class="quest-list">
            @for (questName of confirmModalData()?.questNames || []; track questName) {
              <div class="quest-item">
                <mat-icon>assignment_turned_in</mat-icon>
                <span>{{ questName }}</span>
              </div>
            }
          </div>
          
          <div class="modal-summary">
            <strong>ì´ {{ confirmModalData()?.questCount || 0 }}ê°œì˜ í€˜ìŠ¤íŠ¸</strong>ë¥¼ ì™„ë£Œë¡œ í‘œì‹œí•©ë‹ˆë‹¤.
          </div>
        </div>
        
        <div class="modal-actions">
          <button class="btn btn-secondary modal-btn" (click)="cancelQuestCompletion()">
            <mat-icon>close</mat-icon>
            ì·¨ì†Œ
          </button>
          <button class="btn btn-primary modal-btn" (click)="confirmQuestCompletion()">
            <mat-icon>check</mat-icon>
            ì™„ë£Œ ì²˜ë¦¬
          </button>
        </div>
      </div>
    </div>
  }

  <!-- ë¡œë”© ìƒíƒœ -->
  @if (isLoading()) {
    <div class="loading-container">
      <div class="loading-spinner">
        <div class="spinner"></div>
        <p>ê·¸ë£¹ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
      </div>
    </div>
  }
  
  <!-- ì—ëŸ¬ ìƒíƒœ -->
  @else if (error() !== null) {
    <div class="error-container">
      <div class="error-card">
        <div class="error-icon">âš ï¸</div>
        <h3>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h3>
        <p>{{ error() }}</p>
        <button class="btn btn-primary" (click)="retry()">
          <mat-icon>refresh</mat-icon>
          ë‹¤ì‹œ ì‹œë„
        </button>
      </div>
    </div>
  }
  
  <!-- ì •ìƒ ëŒ€ì‹œë³´ë“œ -->
  @else {
    <!-- í˜ì´ì§€ í—¤ë” -->
    <div class="page-header">
      <div class="header-content">
        <h1 class="page-title">{{ title() }}</h1>
        <p class="page-description">ì˜¤ëŠ˜ë„ ëª©í‘œë¥¼ í–¥í•´ í•œ ê±¸ìŒ ë” ë‚˜ì•„ê°€ìš”! ğŸ’ª</p>
      </div>
      <div class="header-stats">
        <div class="quick-stat">
          <span class="stat-number">{{ getTodayAchievementRate() }}%</span>
          <span class="stat-label">ì˜¤ëŠ˜ ë‹¬ì„±ë¥ </span>
        </div>
      </div>
    </div>

    <!-- ì¼ì¼ í€˜ìŠ¤íŠ¸ ì„¹ì…˜ -->
    <div class="section-card">
      <div class="section-header">
        <h2 class="section-title">
          <mat-icon>assignment</mat-icon>
          ì¼ì¼ í€˜ìŠ¤íŠ¸ ì§„ì²™ì‚¬í•­
        </h2>
        <p class="section-subtitle">í´ë¦­í•˜ì—¬ í€˜ìŠ¤íŠ¸ë¥¼ ì„ íƒí•˜ê³  ì™„ë£Œí•´ë³´ì„¸ìš”</p>
      </div>
      
      @if (quests().length > 0) {
        <div class="quest-grid">
          @for (quest of quests(); track quest.id) {
            <div class="quest-card" 
                 [attr.data-status]="quest.status"
                 [class.selected]="isQuestSelected(quest.id)"
                 [class.disabled]="!isQuestCompletable(quest)"
                 [class.cache-completed]="isQuestCompletedInCache(quest.id)"
                 (click)="onQuestClick(quest)">
              
              @if (isQuestSelected(quest.id)) {
                <div class="selection-indicator">
                  <mat-icon>check_circle</mat-icon>
                </div>
              }
              
              @if (isQuestCompletedInCache(quest.id)) {
                <div class="completion-badge">
                  <mat-icon>verified</mat-icon>
                  <span>ì™„ë£Œë¨</span>
                </div>
              }
              
              <div class="quest-header">
                <div class="quest-icon">{{ quest.icon }}</div>
                <div class="quest-info">
                  <h3 class="quest-title">{{ quest.title }}</h3>
                  <p class="quest-description">{{ quest.description }}</p>
                </div>
              </div>
              
              <div class="quest-progress-container">
                <div class="quest-progress">
                  <div 
                    class="quest-progress-bar" 
                    [attr.data-progress]="quest.progress"
                    [style.background-color]="getStatusColor(quest.status)">
                  </div>
                </div>
                <div class="quest-status">
                  <span 
                    class="status-badge"
                    [style.color]="getStatusColor(quest.status)">
                    {{ getStatusText(quest.status) }}
                  </span>
                  <span class="progress-text">{{ quest.progress }}% ì™„ë£Œ</span>
                </div>
              </div>
            </div>
          }
        </div>

        <div class="action-section">
          <button class="btn btn-primary" 
                  [class.btn-active]="hasSelectedQuests()"
                  [disabled]="!hasSelectedQuests()"
                  (click)="onQuestAction()">
            <mat-icon>check</mat-icon>
            ì„ íƒí•œ í€˜ìŠ¤íŠ¸ ì™„ë£Œí•˜ê¸° ({{ selectedQuestIds().size }})
          </button>
          
          @if (hasCompletedQuests()) {
            <div class="completed-quests-info">
              <mat-icon>info</mat-icon>
              <span>ì¼ë¶€ í€˜ìŠ¤íŠ¸ê°€ ì´ë¯¸ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤</span>
            </div>
          }
        </div>
      } @else {
        <div class="empty-state">
          <div class="empty-icon">ğŸ“</div>
          <h4>ì•„ì§ í€˜ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤</h4>
          <p>ê³§ ìƒˆë¡œìš´ í€˜ìŠ¤íŠ¸ê°€ ì¶”ê°€ë  ì˜ˆì •ì…ë‹ˆë‹¤!</p>
        </div>
      }
    </div>

    <!-- í†µê³„ ì„¹ì…˜ -->
    <div class="section-card">
      <div class="section-header">
        <h2 class="section-title">
          <mat-icon>trending_up</mat-icon>
          ê·¸ë£¹ í˜„í™©
        </h2>
        <p class="section-subtitle">ì „ì²´ í˜„í™©ì„ í•œëˆˆì— í™•ì¸í•˜ì„¸ìš”</p>
      </div>
      
      <div class="stats-grid">
        @for (stat of stats(); track stat.id) {
          <div class="stat-card">
            <div class="stat-icon">
              <mat-icon>{{ stat.icon }}</mat-icon>
            </div>
            <div class="stat-content">
              <div class="stat-number">{{ stat.value }}{{ stat.unit }}</div>
              <div class="stat-label">{{ stat.label }}</div>
            </div>
          </div>
        }
      </div>
    </div>

    <!-- ìµœê·¼ í™œë™ ì„¹ì…˜ -->
    <div class="section-card">
      <div class="section-header">
        <h2 class="section-title">
          <mat-icon>history</mat-icon>
          ìµœê·¼ í™œë™
        </h2>
        <p class="section-subtitle">ìµœê·¼ ê·¸ë£¹ í™œë™ í˜„í™©</p>
      </div>
      
      <div class="activity-feed">
        <div class="activity-item">
          <div class="activity-avatar">ğŸƒ</div>
          <div class="activity-content">
            <div class="activity-text">
              <strong>ê¹€ì² ìˆ˜</strong>ë‹˜ì´ ìš´ë™ ì±Œë¦°ì§€ë¥¼ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤
            </div>
            <div class="activity-time">5ë¶„ ì „</div>
          </div>
          <div class="activity-badge success">ì™„ë£Œ</div>
        </div>
        
        <div class="activity-item">
          <div class="activity-avatar">ğŸ“š</div>
          <div class="activity-content">
            <div class="activity-text">
              <strong>ì´ì˜í¬</strong>ë‹˜ì´ ë…ì„œ ì¸ì¦ì„ ì—…ë¡œë“œí–ˆìŠµë‹ˆë‹¤
            </div>
            <div class="activity-time">12ë¶„ ì „</div>
          </div>
          <div class="activity-badge in-progress">ì¸ì¦</div>
        </div>
        
        <div class="activity-item">
          <div class="activity-avatar">ğŸ’§</div>
          <div class="activity-content">
            <div class="activity-text">
              <strong>ë°•ë¯¼ìˆ˜</strong>ë‹˜ì´ ë¬¼ ë§ˆì‹œê¸° ëª©í‘œë¥¼ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤
            </div>
            <div class="activity-time">25ë¶„ ì „</div>
          </div>
          <div class="activity-badge success">ë‹¬ì„±</div>
        </div>
      </div>
    </div>
  }
</div>