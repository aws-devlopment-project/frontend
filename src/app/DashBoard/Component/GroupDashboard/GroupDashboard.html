<div class="content">
  <!-- 플로팅 피드백 UI -->
  @if (showFeedback()) {
    <div class="floating-feedback-overlay">
      <div class="floating-feedback-card">
        <div class="feedback-header">
          <div class="feedback-icon">🎉</div>
          <div class="feedback-title">퀘스트 완료!</div>
          <button class="feedback-close" (click)="closeFeedback()">
            <mat-icon>close</mat-icon>
          </button>
        </div>
        
        <div class="feedback-content">
          <h3>{{ feedbackData()?.questTitle }}</h3>
          <p>축하합니다! 퀘스트를 성공적으로 완료하셨습니다.</p>
          <p class="feedback-question">이 퀘스트는 어떠셨나요?</p>
          
          <div class="rating-section">
            <div class="rating-stars">
              @for (star of [1,2,3,4,5]; track star) {
                <button 
                  class="star-button"
                  [class.active]="feedbackScore() >= star"
                  [class.selected]="feedbackScore() === star"
                  (click)="setFeedbackScore(star)"
                  [disabled]="isSubmittingFeedback()">
                  <mat-icon>{{ feedbackScore() >= star ? 'star' : 'star_border' }}</mat-icon>
                </button>
              }
            </div>
            <div class="rating-labels">
              <span class="rating-label-left">별로예요</span>
              <span class="rating-label-right">최고예요</span>
            </div>
          </div>
          
          <div class="feedback-actions">
            <button 
              class="btn btn-secondary feedback-btn" 
              (click)="closeFeedback()"
              [disabled]="isSubmittingFeedback()">
              건너뛰기
            </button>
            <button 
              class="btn btn-primary feedback-btn" 
              [disabled]="feedbackScore() === 0 || isSubmittingFeedback()"
              (click)="submitFeedback()">
              @if (isSubmittingFeedback()) {
                <div class="btn-spinner"></div>
                전송 중...
              } @else {
                <mat-icon>send</mat-icon>
                피드백 전송
              }
            </button>
          </div>
        </div>
      </div>
    </div>
  }

  <!-- 퀘스트 완료 확인 모달 -->
  @if (showConfirmModal()) {
    <div class="confirm-modal-overlay">
      <div class="confirm-modal-card">
        <div class="modal-header">
          <div class="modal-icon">✅</div>
          <h3>퀘스트 완료 확인</h3>
        </div>
        
        <div class="modal-content">
          <p>다음 퀘스트들을 완료하시겠습니까?</p>
          
          <div class="quest-list">
            @for (questName of confirmModalData()?.questNames || []; track questName) {
              <div class="quest-item">
                <mat-icon>assignment_turned_in</mat-icon>
                <span>{{ questName }}</span>
              </div>
            }
          </div>
          
          <div class="modal-summary">
            <strong>총 {{ confirmModalData()?.questCount || 0 }}개의 퀘스트</strong>를 완료로 표시합니다.
          </div>
        </div>
        
        <div class="modal-actions">
          <button class="btn btn-secondary modal-btn" (click)="cancelQuestCompletion()">
            <mat-icon>close</mat-icon>
            취소
          </button>
          <button class="btn btn-primary modal-btn" (click)="confirmQuestCompletion()">
            <mat-icon>check</mat-icon>
            완료 처리
          </button>
        </div>
      </div>
    </div>
  }

  <!-- 로딩 상태 -->
  @if (isLoading()) {
    <div class="loading-container">
      <div class="loading-spinner">
        <div class="spinner"></div>
        <p>그룹 데이터를 불러오는 중...</p>
      </div>
    </div>
  }
  
  <!-- 에러 상태 -->
  @else if (error() !== null) {
    <div class="error-container">
      <div class="error-card">
        <div class="error-icon">⚠️</div>
        <h3>데이터를 불러올 수 없습니다</h3>
        <p>{{ error() }}</p>
        <button class="btn btn-primary" (click)="retry()">
          <mat-icon>refresh</mat-icon>
          다시 시도
        </button>
      </div>
    </div>
  }
  
  <!-- 정상 대시보드 -->
  @else {
    <!-- 페이지 헤더 -->
    <div class="page-header">
      <div class="header-content">
        <h1 class="page-title">{{ title() }}</h1>
        <p class="page-description">오늘도 목표를 향해 한 걸음 더 나아가요! 💪</p>
      </div>
      <div class="header-stats">
        <div class="quick-stat">
          <span class="stat-number">{{ getTodayAchievementRate() }}%</span>
          <span class="stat-label">오늘 달성률</span>
        </div>
      </div>
    </div>

    <!-- 일일 퀘스트 섹션 -->
    <div class="section-card">
      <div class="section-header">
        <h2 class="section-title">
          <mat-icon>assignment</mat-icon>
          일일 퀘스트 진척사항
        </h2>
        <p class="section-subtitle">클릭하여 퀘스트를 선택하고 완료해보세요</p>
      </div>
      
      @if (quests().length > 0) {
        <div class="quest-grid">
          @for (quest of quests(); track quest.id) {
            <div class="quest-card" 
                 [attr.data-status]="quest.status"
                 [class.selected]="isQuestSelected(quest.id)"
                 [class.disabled]="!isQuestCompletable(quest)"
                 [class.cache-completed]="isQuestCompletedInCache(quest.id)"
                 (click)="onQuestClick(quest)">
              
              @if (isQuestSelected(quest.id)) {
                <div class="selection-indicator">
                  <mat-icon>check_circle</mat-icon>
                </div>
              }
              
              @if (isQuestCompletedInCache(quest.id)) {
                <div class="completion-badge">
                  <mat-icon>verified</mat-icon>
                  <span>완료됨</span>
                </div>
              }
              
              <div class="quest-header">
                <div class="quest-icon">{{ quest.icon }}</div>
                <div class="quest-info">
                  <h3 class="quest-title">{{ quest.title }}</h3>
                  <p class="quest-description">{{ quest.description }}</p>
                </div>
              </div>
              
              <div class="quest-progress-container">
                <div class="quest-progress">
                  <div 
                    class="quest-progress-bar" 
                    [attr.data-progress]="quest.progress"
                    [style.background-color]="getStatusColor(quest.status)">
                  </div>
                </div>
                <div class="quest-status">
                  <span 
                    class="status-badge"
                    [style.color]="getStatusColor(quest.status)">
                    {{ getStatusText(quest.status) }}
                  </span>
                  <span class="progress-text">{{ quest.progress }}% 완료</span>
                </div>
              </div>
            </div>
          }
        </div>

        <div class="action-section">
          <button class="btn btn-primary" 
                  [class.btn-active]="hasSelectedQuests()"
                  [disabled]="!hasSelectedQuests()"
                  (click)="onQuestAction()">
            <mat-icon>check</mat-icon>
            선택한 퀘스트 완료하기 ({{ selectedQuestIds().size }})
          </button>
          
          @if (hasCompletedQuests()) {
            <div class="completed-quests-info">
              <mat-icon>info</mat-icon>
              <span>일부 퀘스트가 이미 완료되었습니다</span>
            </div>
          }
        </div>
      } @else {
        <div class="empty-state">
          <div class="empty-icon">📝</div>
          <h4>아직 퀘스트가 없습니다</h4>
          <p>곧 새로운 퀘스트가 추가될 예정입니다!</p>
        </div>
      }
    </div>

    <!-- 통계 섹션 -->
    <div class="section-card">
      <div class="section-header">
        <h2 class="section-title">
          <mat-icon>trending_up</mat-icon>
          그룹 현황
        </h2>
        <p class="section-subtitle">전체 현황을 한눈에 확인하세요</p>
      </div>
      
      <div class="stats-grid">
        @for (stat of stats(); track stat.id) {
          <div class="stat-card">
            <div class="stat-icon">
              <mat-icon>{{ stat.icon }}</mat-icon>
            </div>
            <div class="stat-content">
              <div class="stat-number">{{ stat.value }}{{ stat.unit }}</div>
              <div class="stat-label">{{ stat.label }}</div>
            </div>
          </div>
        }
      </div>
    </div>

    <!-- 최근 활동 섹션 -->
    <div class="section-card">
      <div class="section-header">
        <h2 class="section-title">
          <mat-icon>history</mat-icon>
          최근 활동
        </h2>
        <p class="section-subtitle">최근 그룹 활동 현황</p>
      </div>
      
      <div class="activity-feed">
        <div class="activity-item">
          <div class="activity-avatar">🏃</div>
          <div class="activity-content">
            <div class="activity-text">
              <strong>김철수</strong>님이 운동 챌린지를 완료했습니다
            </div>
            <div class="activity-time">5분 전</div>
          </div>
          <div class="activity-badge success">완료</div>
        </div>
        
        <div class="activity-item">
          <div class="activity-avatar">📚</div>
          <div class="activity-content">
            <div class="activity-text">
              <strong>이영희</strong>님이 독서 인증을 업로드했습니다
            </div>
            <div class="activity-time">12분 전</div>
          </div>
          <div class="activity-badge in-progress">인증</div>
        </div>
        
        <div class="activity-item">
          <div class="activity-avatar">💧</div>
          <div class="activity-content">
            <div class="activity-text">
              <strong>박민수</strong>님이 물 마시기 목표를 달성했습니다
            </div>
            <div class="activity-time">25분 전</div>
          </div>
          <div class="activity-badge success">달성</div>
        </div>
      </div>
    </div>
  }
</div>