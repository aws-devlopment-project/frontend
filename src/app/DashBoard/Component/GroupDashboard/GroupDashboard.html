<div class="content">
  <!-- í”Œë¡œíŒ… í”¼ë“œë°± UI (í…ìŠ¤íŠ¸ ì…ë ¥ìœ¼ë¡œ ë³€ê²½) -->
  @if (showFeedback()) {
    <div class="floating-feedback-overlay">
      <div class="floating-feedback-card">
        <div class="feedback-header">
          <div class="feedback-icon">ğŸ‰</div>
          <div class="feedback-title">í€˜ìŠ¤íŠ¸ ì™„ë£Œ!</div>
          <button class="feedback-close" (click)="closeFeedback()">
            <mat-icon>close</mat-icon>
          </button>
        </div>
        
        <div class="feedback-content">
          <h3>{{ feedbackDataTitle() }}</h3>
          <p>ì¶•í•˜í•©ë‹ˆë‹¤! í€˜ìŠ¤íŠ¸ë¥¼ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œí•˜ì…¨ìŠµë‹ˆë‹¤.</p>
          <p class="feedback-question">ì´ í€˜ìŠ¤íŠ¸ëŠ” ì–´ë– ì…¨ë‚˜ìš”?</p>
          
          <!-- ì¢‹ì•„ìš”/ì‹«ì–´ìš” ì„ íƒ -->
          <div class="like-dislike-section">
            <div class="like-dislike-buttons">
              <button 
                class="like-btn"
                [class.selected]="feedbackLike() === true"
                (click)="setFeedbackLike(true)"
                [disabled]="isSubmittingFeedback()">
                <mat-icon>thumb_up</mat-icon>
                <span>ì¢‹ì•˜ì–´ìš”</span>
              </button>
              <button 
                class="dislike-btn"
                [class.selected]="feedbackLike() === false"
                (click)="setFeedbackLike(false)"
                [disabled]="isSubmittingFeedback()">
                <mat-icon>thumb_down</mat-icon>
                <span>ì•„ì‰¬ì›Œìš”</span>
              </button>
            </div>
            @if (feedbackLike() !== null) {
              <div class="selection-feedback">
                {{ feedbackLike() ? 'ğŸ‘ ì¢‹ì€ ê²½í—˜ì´ì…¨êµ°ìš”!' : 'ğŸ‘ ê°œì„ í•  ì ì„ ì•Œë ¤ì£¼ì„¸ìš”!' }}
              </div>
            }
          </div>
          
          <!-- í…ìŠ¤íŠ¸ í”¼ë“œë°± ì…ë ¥ -->
          <div class="feedback-input-section">
            <mat-form-field appearance="outline" class="feedback-textarea">
              <mat-label>
                {{ feedbackLike() === true ? 'ì–´ë–¤ ì ì´ ì¢‹ì•˜ëŠ”ì§€ ì•Œë ¤ì£¼ì„¸ìš”' : 
                   feedbackLike() === false ? 'ì–´ë–¤ ì ì´ ì•„ì‰¬ì› ëŠ”ì§€ ì•Œë ¤ì£¼ì„¸ìš”' : 
                   'í€˜ìŠ¤íŠ¸ì— ëŒ€í•œ ì†Œê°ì„ ì•Œë ¤ì£¼ì„¸ìš”' }}
              </mat-label>
              <textarea 
                matInput 
                rows="4"
                maxlength="200"
                [placeholder]="feedbackLike() === true ? 
                  'ì˜ˆ: ëª©í‘œê°€ ëª…í™•í•´ì„œ ì‹¤í–‰í•˜ê¸° ì‰¬ì› ì–´ìš”. ì„±ì·¨ê°ë„ ëŠë‚„ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤!' :
                  feedbackLike() === false ?
                  'ì˜ˆ: ëª©í‘œê°€ ë„ˆë¬´ ì–´ë ¤ì› ì–´ìš”. ì¢€ ë” ë‹¨ê³„ì ì¸ ì ‘ê·¼ì´ í•„ìš”í•  ê²ƒ ê°™ìŠµë‹ˆë‹¤.' :
                  'ì´ í€˜ìŠ¤íŠ¸ë¥¼ ì™„ë£Œí•˜ë©´ì„œ ëŠë‚€ ì ì´ë‚˜ ê°œì„  ì‚¬í•­ ë“±ì„ ììœ ë¡­ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”...'"
                [value]="feedbackText()"
                (input)="onFeedbackTextChange($event)"
                [disabled]="isSubmittingFeedback()">
              </textarea>
              <mat-hint>{{ feedbackTextLength() }}/200ì</mat-hint>
              @if (!isFeedbackValid() && (feedbackTextLength() > 0 || feedbackLike() !== null)) {
                <mat-error>
                  @if (feedbackLike() === null) {
                    ì¢‹ì•„ìš”/ì‹«ì–´ìš”ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”
                  } @else if (feedbackTextLength() < 5) {
                    ìµœì†Œ 5ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”
                  }
                </mat-error>
              }
            </mat-form-field>
          </div>
          
          <div class="feedback-actions">
            <button 
              class="btn btn-secondary feedback-btn" 
              (click)="closeFeedback()"
              [disabled]="isSubmittingFeedback()">
              ê±´ë„ˆë›°ê¸°
            </button>
            <button 
              class="btn btn-primary feedback-btn" 
              [disabled]="!isFeedbackValid() || isSubmittingFeedback()"
              (click)="submitFeedback()">
              @if (isSubmittingFeedback()) {
                <div class="btn-spinner"></div>
                ì „ì†¡ ì¤‘...
              } @else {
                <mat-icon>send</mat-icon>
                í”¼ë“œë°± ì „ì†¡
              }
            </button>
          </div>
        </div>
      </div>
    </div>
  }

  <!-- í€˜ìŠ¤íŠ¸ ì™„ë£Œ í™•ì¸ ëª¨ë‹¬ -->
  @if (showConfirmModal()) {
    <div class="confirm-modal-overlay">
      <div class="confirm-modal-card">
        <div class="modal-header">
          <div class="modal-icon">âœ…</div>
          <h3>í€˜ìŠ¤íŠ¸ ì™„ë£Œ í™•ì¸</h3>
        </div>
        
        <div class="modal-content">
          <p>ë‹¤ìŒ í€˜ìŠ¤íŠ¸ë“¤ì„ ì™„ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
          
          <div class="quest-list">
            @for (questName of confirmModalData()?.questNames || []; track questName) {
              <div class="quest-item">
                <mat-icon>assignment_turned_in</mat-icon>
                <span>{{ questName }}</span>
              </div>
            }
          </div>
          
          <div class="modal-summary">
            <strong>ì´ {{ confirmModalData()?.questCount || 0 }}ê°œì˜ í€˜ìŠ¤íŠ¸</strong>ë¥¼ ì™„ë£Œë¡œ í‘œì‹œí•©ë‹ˆë‹¤.
          </div>
        </div>
        
        <div class="modal-actions">
          <button class="btn btn-secondary modal-btn" (click)="cancelQuestCompletion()">
            <mat-icon>close</mat-icon>
            ì·¨ì†Œ
          </button>
          <button class="btn btn-primary modal-btn" (click)="confirmQuestCompletion()">
            <mat-icon>check</mat-icon>
            ì™„ë£Œ ì²˜ë¦¬
          </button>
        </div>
      </div>
    </div>
  }

  <!-- ë¡œë”© ìƒíƒœ -->
  @if (isLoading()) {
    <div class="loading-container">
      <div class="loading-spinner">
        <div class="spinner"></div>
        <p>ê·¸ë£¹ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
      </div>
    </div>
  }
  
  <!-- ì—ëŸ¬ ìƒíƒœ -->
  @else if (error() !== null) {
    <div class="error-container">
      <div class="error-card">
        <div class="error-icon">âš ï¸</div>
        <h3>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h3>
        <p>{{ error() }}</p>
        <button class="btn btn-primary" (click)="retry()">
          <mat-icon>refresh</mat-icon>
          ë‹¤ì‹œ ì‹œë„
        </button>
      </div>
    </div>
  }
  
  <!-- ì •ìƒ ëŒ€ì‹œë³´ë“œ -->
  @else {
    <!-- í˜ì´ì§€ í—¤ë” -->
    <div class="page-header">
      <div class="header-content">
        <h1 class="page-title">{{ title() }}</h1>
        <p class="page-description">ì˜¤ëŠ˜ë„ ëª©í‘œë¥¼ í–¥í•´ í•œ ê±¸ìŒ ë” ë‚˜ì•„ê°€ìš”! ğŸ’ª</p>
      </div>
      <div class="header-stats">
        <div class="quick-stat">
          <span class="stat-number">{{ getTodayAchievementRate() }}%</span>
          <span class="stat-label">ì˜¤ëŠ˜ ë‹¬ì„±ë¥ </span>
        </div>
      </div>
    </div>

    <!-- ì¼ì¼ í€˜ìŠ¤íŠ¸ ì„¹ì…˜ -->
    <div class="section-card">
      <div class="section-header">
        <h2 class="section-title">
          <mat-icon>assignment</mat-icon>
          ì¼ì¼ í€˜ìŠ¤íŠ¸ ì§„ì²™ì‚¬í•­
        </h2>
        <p class="section-subtitle">í´ë¦­í•˜ì—¬ í€˜ìŠ¤íŠ¸ë¥¼ ì„ íƒí•˜ê³  ì™„ë£Œí•´ë³´ì„¸ìš”</p>
      </div>
      
      @if (quests().length > 0) {
        <div class="quest-grid">
          @for (quest of quests(); track quest.id) {
            <div [class]="getQuestCardClass(quest)"
                 (click)="onQuestClick(quest)">
              
              <!-- ğŸ¯ ê°œì¸ ì™„ë£Œ ìƒíƒœ í‘œì‹œ (ì¹´ë“œ ìƒë‹¨) -->
              <div class="personal-status-header">
                <div class="personal-status-indicator">
                  <mat-icon [style.color]="getPersonalStatusColor(quest)">
                    {{ getPersonalStatusIcon(quest) }}
                  </mat-icon>
                  <span class="personal-status-text">
                    @if (isPersonallyCompleted(quest)) {
                      ë‚´ê°€ ì™„ë£Œí•¨
                    } @else if (canSelectQuest(quest)) {
                      ì™„ë£Œ ê°€ëŠ¥
                    } @else {
                      ì™„ë£Œ ë¶ˆê°€
                    }
                  </span>
                </div>
                
                <!-- ì„ íƒ í‘œì‹œ -->
                @if (isQuestSelected(quest.id)) {
                  <div class="selection-badge">
                    <mat-icon>check_circle</mat-icon>
                    <span>ì„ íƒë¨</span>
                  </div>
                }
              </div>

              <!-- í€˜ìŠ¤íŠ¸ ì •ë³´ -->
              <div class="quest-header">
                <div class="quest-icon">{{ quest.icon }}</div>
                <div class="quest-info">
                  <h3 class="quest-title">{{ quest.title }}</h3>
                  <p class="quest-description">{{ quest.description }}</p>
                </div>
              </div>
              
              <!-- ğŸ¯ ê·¸ë£¹ ì§„í–‰ë¥  ì„¹ì…˜ (ê¸°ì¡´ ë°©ì‹ ìœ ì§€) -->
              <div class="group-progress-section">
                <div class="group-progress-header">
                  <span class="group-progress-label">ê·¸ë£¹ ì§„í–‰ë¥ </span>
                  <span class="group-progress-text">{{ getGroupProgressText(quest) }}</span>
                </div>
                
                <div class="group-progress-container">
                  <div class="group-progress-bar">
                    <div class="group-progress-fill" 
                         [style.width.%]="quest.progress"
                         [style.background-color]="getStatusColor(quest.status)">
                    </div>
                  </div>
                  <div class="group-progress-percentage">{{ quest.progress }}%</div>
                </div>
                
                <div class="group-status-text">{{ getGroupStatusText(quest) }}</div>
              </div>

              <!-- ğŸ¯ ì•¡ì…˜ ì˜ì—­ -->
              <div class="quest-actions">
                @if (!isPersonallyCompleted(quest)) {
                  <button class="quest-action-button"
                          [disabled]="!canSelectQuest(quest)"
                          [class.selected]="isQuestSelected(quest.id)">
                    @if (canSelectQuest(quest)) {
                      {{ isQuestSelected(quest.id) ? 'ì„ íƒ ì·¨ì†Œ' : 'ì™„ë£Œí•˜ê¸°' }}
                    } @else {
                      ì™„ë£Œ ë¶ˆê°€
                    }
                  </button>
                } @else {
                  <div class="completed-indicator">
                    <mat-icon>verified</mat-icon>
                    <span>ì™„ë£Œë¨</span>
                  </div>
                }
              </div>
            </div>
          }
        </div>

        <div class="action-section">
          <button class="btn btn-primary" 
                  [class.btn-active]="hasSelectedQuests()"
                  [disabled]="!hasSelectedQuests()"
                  (click)="onQuestAction()">
            <mat-icon>check</mat-icon>
            ì„ íƒí•œ í€˜ìŠ¤íŠ¸ ì™„ë£Œí•˜ê¸° ({{ selectedQuestIds().size }})
          </button>
          
          @if (hasCompletedQuests()) {
            <div class="completed-quests-info">
              <mat-icon>info</mat-icon>
              <span>ì¼ë¶€ í€˜ìŠ¤íŠ¸ê°€ ì´ë¯¸ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤</span>
            </div>
          }
        </div>
      } @else {
        <div class="empty-state">
          <div class="empty-icon">ğŸ“</div>
          <h4>ì•„ì§ í€˜ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤</h4>
          <p>ê³§ ìƒˆë¡œìš´ í€˜ìŠ¤íŠ¸ê°€ ì¶”ê°€ë  ì˜ˆì •ì…ë‹ˆë‹¤!</p>
        </div>
      }
    </div>

    <!-- í†µê³„ ì„¹ì…˜ -->
    <div class="section-card">
      <div class="section-header">
        <h2 class="section-title">
          <mat-icon>trending_up</mat-icon>
          ê·¸ë£¹ í˜„í™©
        </h2>
        <p class="section-subtitle">ì „ì²´ í˜„í™©ì„ í•œëˆˆì— í™•ì¸í•˜ì„¸ìš”</p>
      </div>
      
      <div class="stats-grid">
        @for (stat of stats(); track stat.id) {
          <div class="stat-card">
            <div class="stat-icon">
              <mat-icon>{{ stat.icon }}</mat-icon>
            </div>
            <div class="stat-content">
              <div class="stat-number">{{ stat.value }}{{ stat.unit }}</div>
              <div class="stat-label">{{ stat.label }}</div>
            </div>
          </div>
        }
      </div>
    </div>

    <!-- í–¥ìƒëœ ìµœê·¼ í™œë™ ì„¹ì…˜ -->
    <div class="section-card">
      <div class="section-header">
        <h2 class="section-title">
          <mat-icon>timeline</mat-icon>
          ìµœê·¼ ê·¸ë£¹ í™œë™
        </h2>
        <p class="section-subtitle">ì‹¤ì‹œê°„ í™œë™ í˜„í™©ê³¼ ì„±ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”</p>
        <button class="refresh-btn" (click)="refreshData()" title="ìƒˆë¡œê³ ì¹¨">
          <mat-icon>refresh</mat-icon>
        </button>
      </div>
      
      @if (recentActivities().length > 0) {
        <div class="enhanced-activity-feed">
          @for (activity of recentActivities(); track activity.id) {
            <div class="enhanced-activity-item" [attr.data-type]="activity.type">
              <div class="activity-avatar-enhanced">
                <span class="avatar-emoji">{{ getActivityIcon(activity) }}</span>
              </div>
              
              <div class="activity-content-enhanced">
                <div class="activity-header">
                  <div class="activity-title">{{ activity.title }}</div>
                  <div class="activity-time">{{ getTimeAgo(activity.timestamp) }}</div>
                </div>
                
                <div class="activity-description">{{ activity.description }}</div>
                
                @if (activity.user) {
                  <div class="activity-user">
                    <mat-icon>person</mat-icon>
                    <span>{{ activity.user }}</span>
                  </div>
                }
                
                @if (activity.metadata) {
                  <div class="activity-metadata">
                    @if (activity.metadata.streakDays) {
                      <div class="metadata-item streak">
                        <mat-icon>local_fire_department</mat-icon>
                        <span>{{ activity.metadata.streakDays }}ì¼ ì—°ì†</span>
                      </div>
                    }
                    @if (activity.metadata.questTitle) {
                      <div class="metadata-item quest">
                        <mat-icon>task_alt</mat-icon>
                        <span>{{ activity.metadata.questTitle }}</span>
                      </div>
                    }
                    @if (activity.metadata.achievementLevel) {
                      <div class="metadata-item achievement">
                        <mat-icon>military_tech</mat-icon>
                        <span>ë ˆë²¨ {{ activity.metadata.achievementLevel }}</span>
                      </div>
                    }
                  </div>
                }
              </div>
              
              @if (activity.badge) {
                <div class="activity-badge-enhanced" [class]="getActivityBadgeClass(activity.badge.type)">
                  {{ activity.badge.text }}
                </div>
              }
            </div>
          }
        </div>
        
        <!-- í™œë™ ìš”ì•½ ì¹´ë“œ -->
        <div class="activity-summary-cards">
          <div class="summary-card">
            <div class="summary-icon">ğŸ¯</div>
            <div class="summary-content">
              <div class="summary-number">{{ recentQuestCompletions() }}</div>
              <div class="summary-label">ìµœê·¼ ì™„ë£Œí•œ í€˜ìŠ¤íŠ¸</div>
            </div>
          </div>
          
          <div class="summary-card">
            <div class="summary-icon">ğŸ”¥</div>
            <div class="summary-content">
              <div class="summary-number">{{ currentStreak() }}</div>
              <div class="summary-label">í˜„ì¬ ì—°ì† ê¸°ë¡</div>
            </div>
          </div>
          
          <div class="summary-card">
            <div class="summary-icon">ğŸ‘¥</div>
            <div class="summary-content">
              <div class="summary-number">{{ recentNewMembers() }}</div>
              <div class="summary-label">ìƒˆë¡œìš´ ë©¤ë²„</div>
            </div>
          </div>
        </div>
      } @else {
        <div class="empty-activity-state">
          <div class="empty-activity-icon">
            <mat-icon>timeline</mat-icon>
          </div>
          <h4>ìµœê·¼ í™œë™ì´ ì—†ìŠµë‹ˆë‹¤</h4>
          <p>í€˜ìŠ¤íŠ¸ë¥¼ ì™„ë£Œí•˜ê±°ë‚˜ ìƒˆë¡œìš´ í™œë™ì„ ì‹œì‘í•´ë³´ì„¸ìš”!</p>
          <button class="btn btn-primary" (click)="refreshData()">
            <mat-icon>refresh</mat-icon>
            ìƒˆë¡œê³ ì¹¨
          </button>
        </div>
      }
    </div>
  }
</div>