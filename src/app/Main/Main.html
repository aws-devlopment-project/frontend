<div class="app-container">
  <!-- ë¡œë”© ìƒíƒœ í‘œì‹œ -->
  @if (shouldShowLoading()) {
    <div class="page-placeholder">
      <div class="loading-container">
        <div class="loading-spinner"></div>
        <h2>{{ getLoadingMessage() }}</h2>
        <p>ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”...</p>
        
        <!-- ë””ë²„ê·¸ ì •ë³´ (ê°œë°œ í™˜ê²½ì—ì„œë§Œ) -->
        @if (environment.production === false) {
          <div class="debug-info">
            <details>
              <summary>ë””ë²„ê·¸ ì •ë³´</summary>
              <pre>{{
                {
                  initialized: sharedState.initialized(),
                  hasValidData: sharedState.hasValidData(),
                  hasJoinedGroups: sharedState.hasJoinedGroups(),
                  loadingState: sharedState.loadingState(),
                  error: sharedState.error()
                } | json
              }}</pre>
            </details>
          </div>
        }
      </div>
    </div>
  }

  <!-- ì—ëŸ¬ ìƒíƒœ í‘œì‹œ -->
  @else if (shouldShowError()) {
    <div class="page-placeholder">
      <div class="error-container">
        <div class="error-icon">âš ï¸</div>
        <h2>ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</h2>
        <p>{{ errorMessage() }}</p>
        
        <div class="error-actions">
          <button (click)="refreshData()" class="primary-button">
            ë‹¤ì‹œ ì‹œë„
          </button>
          <button (click)="clearError()" class="secondary-button">
            ì˜¤ë¥˜ ë¬´ì‹œ
          </button>
        </div>
        
        <!-- ìƒì„¸í•œ ì—ëŸ¬ ì •ë³´ (ê°œë°œ í™˜ê²½ì—ì„œë§Œ) -->
        @if (environment.production === false) {
          <details class="error-details">
            <summary>ìƒì„¸ ì •ë³´</summary>
            <pre>{{ errorMessage() }}</pre>
          </details>
        }
      </div>
    </div>
  }

  <!-- ì •ìƒ ìƒíƒœ - ë©”ì¸ ì»¨í…ì¸  -->
  @else if (shouldShowContent()) {
    <!-- ì‚¬ì´ë“œë°” - ë©”ë‰´ë°”ëŠ” í•­ìƒ, ê·¸ë£¹ë°”ëŠ” ì¡°ê±´ë¶€ í‘œì‹œ -->
    <app-sidebar 
      (navigationChange)="onNavigationChange($event)"
      (groupSelect)="onGroupSelect($event)"
      (channelSelect)="onChannelSelect($event)">
    </app-sidebar>

    <!-- ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ -->
    <div class="main-area">
      <!-- í—¤ë” -->
      <app-header
        [showSearch]="true"
        [currentPage]="sharedState.currentPageTitle()"
        (searchQuery)="onSearchQuery($event)"
        (notificationClick)="onNotificationClick()"
        (helpClick)="onHelpClick()"
        (profileClick)="onProfileClick()">
      </app-header>

      <!-- ì½˜í…ì¸  ì˜ì—­ -->
      <main class="content-area">
        @switch (sharedState.activeTab()) {
          @case ('home') {
            <app-home-dashboard></app-home-dashboard>
          }
          
          @case ('group') {
            @if (sharedState.isChannelSelected()) {
              <!-- ì±„ë„ ì„ íƒë¨ - ì±„íŒ… ì¸í„°í˜ì´ìŠ¤ í‘œì‹œ -->
              <app-main-container></app-main-container>
            }
            @else if (sharedState.isGroupSelected()) {
              <!-- ê·¸ë£¹ ì„ íƒë¨ - ê·¸ë£¹ ëŒ€ì‹œë³´ë“œ í‘œì‹œ -->
              <app-group-dashboard></app-group-dashboard>
            }
            @else {
              <!-- ê·¸ë£¹/ì±„ë„ ë¯¸ì„ íƒ ìƒíƒœ -->
              <div class="page-placeholder">
                @if (sharedState.hasJoinedGroups()) {
                  <!-- ê¸°ì¡´ ì‚¬ìš©ì - ê·¸ë£¹ ì„ íƒ ì•ˆë‚´ -->
                  <h2>ê·¸ë£¹ì„ ì„ íƒí•´ ì£¼ì„¸ìš”</h2>
                  <p>{{ getGroupSelectionMessage() }}</p>
                } @else {
                  <!-- ìƒˆ ì‚¬ìš©ì - ê·¸ë£¹ ì°¸ì—¬ ì•ˆë‚´ -->
                  <div class="new-user-welcome">
                    <div class="welcome-icon">ğŸ¯</div>
                    <h2>í™˜ì˜í•©ë‹ˆë‹¤!</h2>
                    <p>ì•„ì§ ì°¸ì—¬í•œ ê·¸ë£¹ì´ ì—†ìŠµë‹ˆë‹¤.<br>ìƒˆë¡œìš´ ê·¸ë£¹ì— ì°¸ì—¬í•´ì„œ ëª©í‘œë¥¼ ë‹¬ì„±í•´ë³´ì„¸ìš”!</p>
                    
                    <div class="welcome-features">
                      <div class="feature-item">
                        <div class="feature-icon">ğŸ‘¥</div>
                        <div class="feature-text">
                          <h4>í•¨ê»˜ ì„±ì¥</h4>
                          <p>ê°™ì€ ëª©í‘œë¥¼ ê°€ì§„ ì‚¬ëŒë“¤ê³¼ í•¨ê»˜ ë™ê¸°ë¶€ì—¬ë°›ìœ¼ì„¸ìš”</p>
                        </div>
                      </div>
                      
                      <div class="feature-item">
                        <div class="feature-icon">ğŸ“Š</div>
                        <div class="feature-text">
                          <h4>ì§„í–‰ìƒí™© ì¶”ì </h4>
                          <p>ê°œì¸ ë° ê·¸ë£¹ì˜ ë‹¬ì„±ë¥ ì„ í•œëˆˆì— í™•ì¸í•˜ì„¸ìš”</p>
                        </div>
                      </div>
                      
                      <div class="feature-item">
                        <div class="feature-icon">ğŸ†</div>
                        <div class="feature-text">
                          <h4>ì„±ì·¨ê° ê·¹ëŒ€í™”</h4>
                          <p>ë‹¤ì–‘í•œ í™œë™ì„ í†µí•´ ì„±ì·¨ê°ì„ ëŠê»´ë³´ì„¸ìš”</p>
                        </div>
                      </div>
                    </div>
                  </div>
                }
                
                <div class="empty-state">
                  @if (!sharedState.hasJoinedGroups()) {
                    <div class="empty-state-actions">
                      <button class="primary-button btn-large" [routerLink]="['/group/join']">
                        <mat-icon>group_add</mat-icon>
                        ê·¸ë£¹ ì°¸ì—¬í•˜ê¸°
                      </button>
                      <button class="secondary-button" (click)="onNavigationChange('home')">
                        <mat-icon>home</mat-icon>
                        í™ˆìœ¼ë¡œ ì´ë™
                      </button>
                    </div>
                  } @else {
                    <p>ì™¼ìª½ ì‚¬ì´ë“œë°”ì—ì„œ ê·¸ë£¹ì„ ì„ íƒí•˜ë©´ í™œë™ì„ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                  }
                </div>
              </div>
            }
          }
          
          @case ('activity') {
            @if (sharedState.hasJoinedGroups()) {
              <app-activity-dashboard></app-activity-dashboard>
            } @else {
              <!-- í™œë™ íƒ­ì´ì§€ë§Œ ì°¸ì—¬í•œ ê·¸ë£¹ì´ ì—†ëŠ” ê²½ìš° -->
              <div class="page-placeholder">
                <h2>í™œë™ í†µê³„</h2>
                <p>ê·¸ë£¹ì— ì°¸ì—¬í•˜ë©´ í™œë™ í†µê³„ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                <div class="empty-state">
                  <button class="primary-button" [routerLink]="['/group/join']">
                    <mat-icon>group_add</mat-icon>
                    ê·¸ë£¹ ì°¸ì—¬í•˜ê¸°
                  </button>
                </div>
              </div>
            }
          }
          
          @case ('member') {
            <app-member-dashboard></app-member-dashboard>
          }
          
          @default {
            <!-- ì•Œ ìˆ˜ ì—†ëŠ” íƒ­ - í™ˆìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ -->
            <div class="page-placeholder">
              <h2>í˜ì´ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h2>
              <p>ìš”ì²­í•˜ì‹  í˜ì´ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
              <button (click)="onNavigationChange('home')" class="primary-button">
                í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
              </button>
            </div>
          }
        }
        <app-chatbot></app-chatbot>
      </main>
    </div>
  }

  <!-- ì´ˆê¸°í™”ë˜ì§€ ì•Šì€ ìƒíƒœ -->
  @else {
    <div class="page-placeholder">
      <div class="initialization-container">
        <div class="loading-spinner"></div>
        <h2>ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹œì‘í•˜ëŠ” ì¤‘...</h2>
        <p>ì´ˆê¸° ì„¤ì •ì„ ì§„í–‰í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>
        
        <!-- ì´ˆê¸°í™” íƒ€ì„ì•„ì›ƒ ì‹œ ì¬ì‹œë„ ì˜µì…˜ -->
        <div class="initialization-timeout" 
             [style.display]="'none'"
             #timeoutElement>
          <p>ì´ˆê¸°í™”ê°€ ì˜¤ë˜ ê±¸ë¦¬ê³  ìˆìŠµë‹ˆë‹¤.</p>
          <button (click)="refreshData()" class="secondary-button">
            ë‹¤ì‹œ ì‹œë„
          </button>
        </div>
      </div>
    </div>
  }
</div>