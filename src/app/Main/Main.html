<div class="app-container">
  <!-- ë¡œë”© ìƒíƒœ í‘œì‹œ -->
  @if (shouldShowLoading()) {
    <div class="page-placeholder">
      <div class="loading-container">
        <div class="loading-spinner"></div>
        <h2>{{ getLoadingMessage() }}</h2>
        <p>ì ì‹œë§Œ ê¸°ë‹¤ë ¤ ì£¼ì„¸ìš”...</p>
        
        <!-- ë””ë²„ê·¸ ì •ë³´ (ê°œë°œ í™˜ê²½ì—ì„œë§Œ) -->
        @if (environment.production === false) {
          <div class="debug-info">
            <details>
              <summary>ë””ë²„ê·¸ ì •ë³´</summary>
              <pre>{{
                {
                  initialized: sharedState.initialized(),
                  hasValidData: sharedState.hasValidData(),
                  loadingState: sharedState.loadingState(),
                  error: sharedState.error(),
                  hasGroups: sharedState.hasGroups(),
                  hasChannels: sharedState.hasChannels(),
                  navigationState: sharedState.navigationState()
                } | json
              }}</pre>
              <button (click)="debugState()" class="secondary-button">
                ì½˜ì†”ì— ìƒíƒœ ì¶œë ¥
              </button>
            </details>
          </div>
        }
      </div>
    </div>
  }

  <!-- ì—ëŸ¬ ìƒíƒœ í‘œì‹œ -->
  @else if (shouldShowError()) {
    <div class="page-placeholder">
      <div class="error-container">
        <div class="error-icon">âš ï¸</div>
        <h2>ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</h2>
        <p>{{ errorMessage() }}</p>
        
        <div class="error-actions">
          <button (click)="refreshData()" class="primary-button">
            ë‹¤ì‹œ ì‹œë„
          </button>
          <button (click)="clearError()" class="secondary-button">
            ì˜¤ë¥˜ ë¬´ì‹œ
          </button>
        </div>
        
        <!-- ìƒì„¸í•œ ì—ëŸ¬ ì •ë³´ (ê°œë°œ í™˜ê²½ì—ì„œë§Œ) -->
        @if (environment.production === false) {
          <details class="error-details">
            <summary>ìƒì„¸ ì •ë³´</summary>
            <pre>{{ errorMessage() }}</pre>
          </details>
        }
      </div>
    </div>
  }

  <!-- ì •ìƒ ìƒíƒœ - ë©”ì¸ ì»¨í…ì¸  -->
  @else if (shouldShowContent()) {
    <!-- ì‚¬ì´ë“œë°” - ë©”ë‰´ë°”ëŠ” í•­ìƒ, ê·¸ë£¹ë°”ëŠ” ì¡°ê±´ë¶€ í‘œì‹œ -->
    <app-sidebar 
      (navigationChange)="onNavigationChange($event)"
      (groupSelect)="onGroupSelect($event)"
      (channelSelect)="onChannelSelect($event)">
    </app-sidebar>

    <!-- ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ -->
    <div class="main-area">
      <!-- í—¤ë” -->
      <app-header
        [showSearch]="true"
        [currentPage]="sharedState.currentPageTitle()"
        (searchQuery)="onSearchQuery($event)"
        (notificationClick)="onNotificationClick()"
        (helpClick)="onHelpClick()"
        (profileClick)="onProfileClick()">
      </app-header>

      <!-- ì½˜í…ì¸  ì˜ì—­ -->
      <main class="content-area">
        @switch (sharedState.activeTab()) {
          @case ('home') {
            <app-home-dashboard></app-home-dashboard>
          }
          
          @case ('group') {
            @if (sharedState.isChannelSelected()) {
              <!-- ì±„ë„ ì„ íƒë¨ - ì±„íŒ… ì¸í„°í˜ì´ìŠ¤ í‘œì‹œ -->
              <app-main-container></app-main-container>
            }
            @else if (sharedState.isGroupSelected()) {
              <!-- ê·¸ë£¹ ì„ íƒë¨ - ê·¸ë£¹ ëŒ€ì‹œë³´ë“œ í‘œì‹œ -->
              <app-group-dashboard></app-group-dashboard>
            }
            @else {
              <!-- ê·¸ë£¹/ì±„ë„ ë¯¸ì„ íƒ ë˜ëŠ” ê°€ì… í•„ìš” ìƒíƒœ -->
              @if (sharedState.hasGroups() && sharedState.hasChannels()) {
                <!-- ê·¸ë£¹ê³¼ ì±„ë„ì´ ìˆì§€ë§Œ ì„ íƒë˜ì§€ ì•Šì€ ê²½ìš° -->
                <div class="page-placeholder">
                  <h2>ê·¸ë£¹ì„ ì„ íƒí•´ ì£¼ì„¸ìš”</h2>
                  <p>ì™¼ìª½ ì‚¬ì´ë“œë°”ì—ì„œ ì°¸ì—¬í•˜ê³  ì‹¶ì€ ê·¸ë£¹ê³¼ ì±„ë„ì„ ì„ íƒí•´ ë³´ì„¸ìš”.</p>
                </div>
              }
              @else if (sharedState.hasGroups() && !sharedState.hasChannels()) {
                <!-- ê·¸ë£¹ì€ ìˆì§€ë§Œ ì±„ë„ì´ ì—†ëŠ” ê²½ìš° -->
                <div class="page-placeholder">
                  <div class="join-guidance-container">
                    <div class="guidance-icon">ğŸ“¢</div>
                    <h2>ì±„ë„ ê°€ì…ì´ í•„ìš”í•©ë‹ˆë‹¤</h2>
                    <p>ê·¸ë£¹ì—ëŠ” ê°€ì…í•˜ì…¨ì§€ë§Œ, ì•„ì§ ì±„ë„ì— ê°€ì…í•˜ì§€ ì•Šìœ¼ì…¨ë„¤ìš”.</p>
                    <p>ì±„ë„ì— ê°€ì…í•´ì•¼ ë‹¤ë¥¸ ë©¤ë²„ë“¤ê³¼ ì†Œí†µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    
                    <div class="guidance-actions">
                      <button (click)="onNavigationChange('member')" class="primary-button">
                        ì±„ë„ ê°€ì…í•˜ê¸°
                      </button>
                      <button (click)="refreshData()" class="secondary-button">
                        ìƒˆë¡œê³ ì¹¨
                      </button>
                    </div>
                    
                    <div class="guidance-tip">
                      <p><strong>ğŸ’¡ íŒ:</strong> ê´€ë¦¬ íƒ­ì—ì„œ ë‹¤ì–‘í•œ ê·¸ë£¹ê³¼ ì±„ë„ì„ íƒìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                    </div>
                  </div>
                </div>
              }
              @else {
                <!-- ê·¸ë£¹ì´ ì—†ëŠ” ê²½ìš° -->
                <div class="page-placeholder">
                  <div class="join-guidance-container">
                    <div class="guidance-icon">ğŸš€</div>
                    <h2>ì²« ê·¸ë£¹ì— ê°€ì…í•´ë³´ì„¸ìš”!</h2>
                    <p>ì•„ì§ ê°€ì…í•œ ê·¸ë£¹ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                    <p>ê´€ì‹¬ ìˆëŠ” ê·¸ë£¹ì— ê°€ì…í•˜ì—¬ ë‹¤ë¥¸ ì‚¬ëŒë“¤ê³¼ ëª©í‘œë¥¼ ê³µìœ í•˜ê³  í•¨ê»˜ ì„±ì¥í•´ë³´ì„¸ìš”!</p>
                    
                    <div class="guidance-actions">
                      <button (click)="onNavigationChange('member')" class="primary-button">
                        ê·¸ë£¹ íƒìƒ‰í•˜ê¸°
                      </button>
                      <button (click)="refreshData()" class="secondary-button">
                        ìƒˆë¡œê³ ì¹¨
                      </button>
                    </div>
                    
                    <div class="guidance-benefits">
                      <h4>ê·¸ë£¹ ê°€ì…ì˜ ì¥ì :</h4>
                      <ul>
                        <li>ê°™ì€ ëª©í‘œë¥¼ ê°€ì§„ ì‚¬ëŒë“¤ê³¼ ì†Œí†µ</li>
                        <li>ì„œë¡œ ê²©ë ¤í•˜ë©° ë™ê¸°ë¶€ì—¬ ë°›ê¸°</li>
                        <li>ì§„í–‰ ìƒí™© ê³µìœ  ë° í”¼ë“œë°±</li>
                        <li>ë‹¤ì–‘í•œ ë„ì „ê³¼ í™œë™ ì°¸ì—¬</li>
                      </ul>
                    </div>
                  </div>
                </div>
              }
            }
          }
          
          @case ('activity') {
            <app-activity-dashboard></app-activity-dashboard>
          }
          
          @case ('member') {
            <app-member-dashboard></app-member-dashboard>
          }
          
          @default {
            <!-- ì•Œ ìˆ˜ ì—†ëŠ” íƒ­ - í™ˆìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ -->
            <div class="page-placeholder">
              <h2>í˜ì´ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</h2>
              <p>ìš”ì²­í•˜ì‹  í˜ì´ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
              <button (click)="onNavigationChange('home')" class="primary-button">
                í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
              </button>
            </div>
          }
        }
      </main>
    </div>
  }

  <!-- ì´ˆê¸°í™”ë˜ì§€ ì•Šì€ ìƒíƒœ -->
  @else {
    <div class="page-placeholder">
      <div class="initialization-container">
        <div class="loading-spinner"></div>
        <h2>ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹œì‘í•˜ëŠ” ì¤‘...</h2>
        <p>ì´ˆê¸° ì„¤ì •ì„ ì§„í–‰í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>
        
        <!-- ì´ˆê¸°í™” íƒ€ì„ì•„ì›ƒ ì‹œ ì¬ì‹œë„ ì˜µì…˜ -->
        <div class="initialization-timeout" 
             [style.display]="'none'"
             #timeoutElement>
          <p>ì´ˆê¸°í™”ê°€ ì˜¤ë˜ ê±¸ë¦¬ê³  ìˆìŠµë‹ˆë‹¤.</p>
          <button (click)="refreshData()" class="secondary-button">
            ë‹¤ì‹œ ì‹œë„
          </button>
        </div>
      </div>
    </div>
  }
</div>