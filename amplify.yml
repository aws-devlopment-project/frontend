version: 1
frontend:
  phases:
    preBuild:
      commands:
        - npm install --no-audit --prefer-offline
        - npx ng version
        - |
          cat <<EOF > src/environments/environment.prod.ts
          export const environment = {
            production: true,
            framework: 'Angular',
            version: '20.1.0',
            buildTool: 'esbuild',
            runtime: 'Node.js',
            userPoolId: '',
            userPoolClientId: '',
            identityPoolId: '',
            region: 'ap-northeast-2',
            googleClientId: '',
            apiUrl: '',
            cognitoDomain: '',
            redirectSignIn: '',
            redirectSignOut: ''
          };
          EOF
        - |
          cat <<EOF > src/environments/environment.ts
          export const environment = {
            production: false,
            framework: 'Angular',
            version: '20.1.0',
            buildTool: 'esbuild',
            runtime: 'Node.js',
            userPoolId: '',
            userPoolClientId: '',
            identityPoolId: '',
            region: 'ap-northeast-2',
            googleClientId: '',
            apiUrl: '',
            cognitoDomain: '',
            redirectSignIn: '',
            redirectSignOut: ''
          };
          EOF
        - |
          cat <<EOF > src/aws-exports.ts
          const awsconfig = {
            aws_project_region: 'ap-northeast-2',
            aws_cognito_region: 'ap-northeast-2',
            aws_user_pools_id: '',
            aws_user_pools_web_client_id: '',
            aws_cognito_identity_pool_id: '',
            oauth: {},
            aws_cognito_username_attributes: [],
            aws_cognito_social_providers: [],
            aws_cognito_signup_attributes: [],
            aws_cognito_mfa_configuration: 'OFF',
            aws_cognito_password_protection_settings: {
              passwordPolicyMinLength: 8,
              passwordPolicyCharacters: []
            },
            aws_cognito_verification_mechanisms: [],
            Auth: {
              Cognito: {
                userPoolId: '',
                userPoolClientId: '',
                identityPoolId: '',
                signUpVerificationMethod: 'code' as const,
                loginWith: {
                  username: false,
                  email: false,
                  phone: false
                }
              }
            }
          };
          
          export default awsconfig;
          EOF
    build:
      commands:
        - npm run build -- --configuration production --verbose
    postBuild:
      commands:
        - chmod +x deploy.sh
        - ./deploy.sh
  artifacts:
    baseDirectory: dist/frontend/browser/
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - .angular/cache/**/*
      - ~/.npm/**/*